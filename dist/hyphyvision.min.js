webpackJsonp([0],{0:function(e,t,n){e.exports=n(1)},1:function(e,t,n){(function(e){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}var a=n(5);t(a);window.$=window.JQuery=e,n(14),n(22),n(24),n(26),n(39);var r=n(44),s=n(218),i=n(219),o=n(220),l=n(221),c=n(223);window.absrel=r,window.busted=s,window.fade=i,window.fade_summary=o,window.relax=l,window.slac=c}).call(t,n(2))},5:function(e,t){},14:function(e,t){},22:function(e,t){},24:function(e,t){},39:function(e,t,n){(function(n,a,r,s){"use strict";var i=function(){};"undefined"!=typeof e&&e.exports&&(t=e.exports=i),t.datamonkey=i,i.errorModal=function(e){n("#modal-error-msg").text(e),n("#errorModal").modal()},i.export_csv_button=function(e){if(e=a.csv.format(e),null!==e){var t=document.createElement("a");t.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","export.csv"),t.className="btn btn-default btn-sm",t.innerHTML='<span class="glyphicon glyphicon-floppy-save"></span> Download CSV',n("body").append(t),t.click(),t.remove()}},i.save_image=function(e,t){function a(e){function t(e){try{if(e.cssRules)for(var a=0;a<e.cssRules.length;a++){var r=e.cssRules[a];3===r.type?t(r.styleSheet):r.selectorText&&r.selectorText.indexOf(">")===-1&&(n+="\n"+r.cssText)}}catch(t){console.log("Could not process stylesheet : "+e)}}var n="",a=e.styleSheets;if(a)for(var r=0;r<a.length;r++)t(a[r]);return n}var r={xmlns:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"},s=function(e){var t=document.getElementById("hyphy-chart-image");t.onload=function(){var e=document.getElementById("hyphy-chart-canvas");e.width=t.width,e.height=t.height;var a=e.getContext("2d");a.fillStyle="#FFFFFF",a.fillRect(0,0,t.width,t.height),a.drawImage(t,0,0);var r=(e.toDataURL("image/png"),document.createElement("a"));r.setAttribute("download","image.png"),r.href=e.toDataURL("image/png"),n("body").append(r),r.click(),r.remove()},t.src=e},i=n(t).find("svg")[0];i||(i=n(t)[0]);var o=a(window.document);i.setAttribute("version","1.1");var l=document.createElement("defs");i.insertBefore(l,i.firstChild);var c=document.createElement("style");l.appendChild(c),c.setAttribute("type","text/css"),i.removeAttribute("xmlns"),i.removeAttribute("xlink"),i.hasAttributeNS(r.xmlns,"xmlns")||i.setAttributeNS(r.xmlns,"xmlns",r.svg),i.hasAttributeNS(r.xmlns,"xmlns:xlink")||i.setAttributeNS(r.xmlns,"xmlns:xlink",r.xlink);var m=(new XMLSerializer).serializeToString(i).replace("</style>","<![CDATA["+o+"]]></style>"),d=(i.getBoundingClientRect(),'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),u=[d+m],p="data:image/svg+xml;base66,"+encodeURIComponent(u);if("png"==e)s(p);else{var h=document.createElement("a");h.setAttribute("download","image.svg"),h.setAttribute("href",p),n("body").append(h),h.click(),h.remove()}},i.jobQueue=function(e){r.templateSettings={evaluate:/\{\%(.+?)\%\}/g,interpolate:/\{\{(.+?)\}\}/g,variable:"rc"},a.json("/jobqueue",function(t){var a=r.template(n("script.job-queue").html()),s=a(t);n("#job-queue-panel").find("table").remove(),n(e).append(s)})},i.status_check=function(){if(n(".status-checker").length){var e="/clusterhealth";a.json(e,function(e){e.successful_connection?(a.select(".status-checker").classed({"status-healthy":!0,"status-troubled":!1}),n(".status-checker").attr("title","Cluster Status : Healthy")):(a.select(".status-checker").classed({"status-healthy":!1,"status-troubled":!0}),n(".status-checker").attr("title","Cluster Status : Troubled; "+e.msg.description))})}},i.validate_date=function(){0===n(this).val().length?(n(this).next(".help-block").remove(),n(this).parent().removeClass("has-success"),n(this).parent().addClass("has-error"),s("<span/>",{class:"help-block",text:"Field is empty"}).insertAfter(n(this))):isNaN(Date.parse(n(this).val()))?(n(this).next(".help-block").remove(),n(this).parent().removeClass("has-success"),n(this).parent().addClass("has-error"),s("<span/>",{class:"help-block",text:"Date format should be in the format YYYY-mm-dd"}).insertAfter(n(this))):(n(this).parent().removeClass("has-error"),n(this).parent().addClass("has-success"),n(this).next(".help-block").remove())},n(document).ready(function(){n(function(){n('[data-toggle="tooltip"]').tooltip()}),n("#datamonkey-header").collapse();var e=n("body").css("padding-top");n("#collapse_nav_bar").on("click",function(t){n("#datamonkey-header").collapse("toggle"),n(this).find("i").toggleClass("fa-times-circle fa-eye");var r=n("body").css("padding-top")==e?"5px":e;a.select("body").transition().style("padding-top",r)})})}).call(t,n(2),n(40),n(43),n(2))},44:function(e,t,n){(function(t,a){"use strict";function r(e,t){m.render(m.createElement(u,{url:e}),document.getElementById(t))}var s=n(45),i=n(203),o=n(204),l=n(205),c=n(207),m=n(46),d=(n(!function(){var e=new Error('Cannot find module "react-dom"');throw e.code="MODULE_NOT_FOUND",e}()),n(39),n(43));n(209);n(206),n(216);var m=n(46),u=m.createClass({displayName:"BSREL",float_format:t.format(".2f"),loadFromServer:function(){var e=this;t.json(this.props.url,function(t){t.fits.MG94["branch-annotations"]=e.formatBranchAnnotations(t,"MG94"),t.fits["Full model"]["branch-annotations"]=e.formatBranchAnnotations(t,"Full model"),t.fits.MG94["annotation-tag"]="ω",t.fits["Full model"]["annotation-tag"]="ω";var n=t.fits["Full model"]["branch-annotations"],a=t,r=t.PMID,s=t["test results"];e.setState({annotations:n,json:a,pmid:r,test_results:s})})},getDefaultProps:function(){var e=function(e,n){var r=this,s=t.select("#tree_container svg"),i=t.select(".phylotree-definitions");i.empty()&&(i=s.append("defs").attr("class","phylotree-definitions"));var o=1/3,l=t.format(".3r"),c=t.format(".2p");t.format(".2f"),t.format(".4f");r.omega_color=t.scale.pow().exponent(o).domain([0,.25,1,5,10]).range(r.options()["color-fill"]?["#DDDDDD","#AAAAAA","#888888","#444444","#000000"]:["#6e4fa2","#3288bd","#e6f598","#f46d43","#9e0142"]).clamp(!0);var m=function(e){function t(e,t,n,a){var s=0,i=e.append("linearGradient").attr("id",t);n.forEach(function(e,t){if(e.prop){var n=s+e.prop;i.append("stop").attr("offset",""+100*s+"%").style("stop-color",r.omega_color(e.omega)),i.append("stop").attr("offset",""+100*n+"%").style("stop-color",r.omega_color(e.omega)),s=n}})}if(void 0==r.gradient_count&&(r.gradient_count=0),e.annotations)if(1==e.annotations.length)e.color=r.omega_color(e.annotations[0].omega);else{r.gradient_count++;var n="branch_gradient_"+r.gradient_count;t(i,n,e.annotations.omegas),e.grad=n}},d=n.target.annotations,u=.05,p="<b>"+n.target.name+"</b>",h=c(0),f="";d&&(h=d.omegas[0].prop,d.omegas.forEach(function(e,t){var n=e.omega>1e20?"&infin;":l(e.omega),a=c(e.prop);p+="<br/>&omega;<sub>"+(t+1)+"</sub> = "+n+" ("+a+")",t&&(f+="<br/>"),f+="&omega;<sub>"+(t+1)+"</sub> = "+n+" ("+a+")"}),p+="<br/><i>p = "+l(d.p)+"</i>",a(e[0][0]).tooltip({title:p,html:!0,trigger:"hover",container:"body",placement:"auto"}),m(n.target),n.target.grad?e.style("stroke","url(#"+n.target.grad+")"):e.style("stroke",n.target.color),e.style("stroke-width",d.p<=u?"12":"5").style("stroke-linejoin","round").style("stroke-linecap","round"))};return{edgeColorizer:e}},getInitialState:function(){var e={omegaPlot:{},"tree-options":{"hyphy-tree-model":["Full model",!0],"hyphy-tree-highlight":[null,!1],"hyphy-tree-branch-lengths":[!0,!0],"hyphy-tree-hide-legend":[!1,!0],"hyphy-tree-fill-color":[!1,!0]},"suppress-tree-render":!1,"chart-append-html":!0,edgeColorizer:this.props.edgeColorizer};return{annotations:null,json:null,pmid:null,settings:e,test_results:null,tree:null}},componentWillMount:function(){this.loadFromServer(),this.setEvents()},setEvents:function(){var e=this;a("#datamonkey-absrel-json-file").on("change",function(t){var n=t.target.files;if(1==n.length){var r=n[0],s=new FileReader;s.onload=function(t){return function(t){var n=JSON.parse(this.result);n.fits.MG94["branch-annotations"]=e.formatBranchAnnotations(n,"MG94"),n.fits["Full model"]["branch-annotations"]=e.formatBranchAnnotations(n,"Full model");var a=n.fits["Full model"]["branch-annotations"],r=n,s=n.PMID,i=n["test results"];e.setState({annotations:a,json:r,pmid:s,test_results:i})}}(r),s.readAsText(r)}a("#datamonkey-absrel-toggle-here").dropdown("toggle"),t.preventDefault()})},formatBranchAnnotations:function(e,t){var n=e.fits[t]["branch-annotations"];n||(n=e.fits[t]["rate distributions"]);var a=d.mapObject(n,function(t,n){var a=[];try{a=JSON.parse(t)}catch(e){a=t}var r={omegas:d.map(a,function(e){return d.object(["omega","prop"],e)})},s=d.clone(e["test results"][n]);return d.extend(s,r),s});return a},initialize:function(){},render:function(){var e=this;return m.createElement("div",{className:"tab-content"},m.createElement("div",{className:"tab-pane active",id:"summary-tab"},m.createElement("div",{className:"row"},m.createElement("div",{id:"summary-div",className:"col-md-12"},m.createElement(s.BSRELSummary,{test_results:e.state.test_results,pmid:e.state.pmid}))),m.createElement("div",{className:"row"},m.createElement("div",{id:"hyphy-tree-summary",className:"col-md-6"},m.createElement(o.TreeSummary,{json:e.state.json})),m.createElement("div",{id:"hyphy-model-fits",className:"col-md-6"},m.createElement(i.ModelFits,{json:e.state.json})))),m.createElement("div",{className:"tab-pane",id:"tree-tab"},m.createElement(l.Tree,{json:e.state.json,settings:e.state.settings})),m.createElement("div",{className:"tab-pane",id:"table_tab"},m.createElement(c.BranchTable,{tree:e.state.tree,test_results:e.state.test_results,annotations:e.state.annotations})))}});e.exports=r}).call(t,n(40),n(2))},45:function(e,t,n){(function(t,a){"use strict";function r(e,t,n){s.render(s.createElement(i,{test_results:e,pmid:t}),document.getElementById(n))}var s=n(46),i=s.createClass({displayName:"BSRELSummary",float_format:t.format(".2f"),countBranchesTested:function(e){return e?e.split(";").length:0},getBranchesWithEvidence:function(e){return a.filter(e,function(e){return e.p<=.05}).length},getTestBranches:function(e){return a.filter(e,function(e){return e.tested>0}).length},getTotalBranches:function(e){return a.keys(e).length},getInitialState:function(){var e=this;return{branches_with_evidence:this.getBranchesWithEvidence(e.props.test_results),test_branches:this.getTestBranches(e.props.test_results),total_branches:this.getTotalBranches(e.props.test_results)}},componentWillReceiveProps:function(e){this.setState({branches_with_evidence:this.getBranchesWithEvidence(e.test_results),test_branches:this.getTestBranches(e.test_results),total_branches:this.getTotalBranches(e.test_results)})},render:function(){var e=this;return s.createElement("ul",{className:"list-group"},s.createElement("li",{className:"list-group-item list-group-item-info"},s.createElement("h3",{className:"list-group-item-heading"},s.createElement("i",{className:"fa fa-list"}),s.createElement("span",{id:"summary-method-name"},"Adaptive branch site REL")," summary"),s.createElement("p",{className:"list-group-item-text lead"},"Evidence",s.createElement("sup",null,"†")," of episodic diversifying selection was found on",s.createElement("strong",null," ",e.state.branches_with_evidence)," out of",s.createElement("span",null," ",e.state.test_branches)," tested branches (",s.createElement("span",null,e.state.total_branches)," total branches)."),s.createElement("p",null,s.createElement("small",null,s.createElement("sup",null,"†"),s.createElement("abbr",{title:"Likelihood Ratio Test"},"LRT")," p ≤ 0.05, corrected for multiple testing.")),s.createElement("p",null,s.createElement("small",null,"Please cite ",s.createElement("a",{href:"http://www.ncbi.nlm.nih.gov/pubmed/25697341",id:"summary-pmid",target:"_blank"},"PMID 25697341")," if you use this result in a publication, presentation, or other scientific work."))))}});e.exports.BSRELSummary=i,e.exports.render_absrel_summary=r}).call(t,n(40),n(43))},203:function(e,t,n){(function(t,a,r){"use strict";function s(e,t){o.render(o.createElement(l,{json:e}),r(t)[0])}function i(e,t){r(t).empty(),s(e,t)}var o=n(46),l=o.createClass({displayName:"ModelFits",getInitialState:function(){var e=this.getModelRows(this.props.json),t=this.getModelColumns(e);return{table_row_data:e,table_columns:t}},formatRuntime:function(e){var t="",e=parseFloat(e),n=[Math.floor(e/86400),Math.floor(e/3600)%24,Math.floor(e/60)%60,e%60],a=["d.","hrs.","min.","sec."];return n.forEach(function(e,n){e&&(t+=" "+e+" "+a[n])}),t},getLogLikelihood:function(e){return t.format(".2f")(e["log-likelihood"])},getAIC:function(e){return t.format(".2f")(e["AIC-c"])},getNumParameters:function(e){return e.parameters},getBranchLengths:function(e){return e["tree length"]?t.format(".2f")(e["tree length"]):t.format(".2f")(t.values(e["branch-lengths"]).reduce(function(e,t){return e+t},0))},getRuntime:function(e){return this.formatRuntime(e.runtime)},getDistributions:function(e,n){var a={};a[e]={};var r=t.format(".3r"),s=t.format(".2p"),i=(t.format(".4f"),[]);for(var o in n["rate-distributions"]){var l=n["rate-distributions"][o],c=[o,"","",""];a[e][o]=l.map(function(e){return{omega:e[0],weight:e[1]}});for(var m=0;m<l.length;m++)c[m+1]=r(l[m][0])+" ("+s(l[m][1])+")";i.push(c)}return i.sort(function(e,t){return e[0]<t[0]?-1:e[0]==t[0]?0:1}),i},getModelRows:function(e){if(!e)return[];var n=[];t.format(".3r"),t.format(".2p"),t.format(".4f");for(var a in e.fits){var r=[],s=e.fits[a];r=[s["display-order"],"",a,this.getLogLikelihood(s),this.getNumParameters(s),this.getAIC(s),this.getRuntime(s),this.getBranchLengths(s)];var i=this.getDistributions(a,s);if(i.length){r=r.concat(i[0]),r[1]=i[0][0],n.push(r);for(var o=1;o<i.length;o++){var l=r.map(function(e,t){return t?"":e});l[1]=i[o][0];for(var c=l.length-4;c<l.length;c++)l[c]=i[o][c-l.length+4];n.push(l)}}else n.push(r)}return n.sort(function(e,t){return e[0]==t[0]?e[1]<t[1]?-1:e[1]==t[1]?0:1:e[0]-t[0]}),n=n.map(function(e){return e.slice(2)})},getModelColumns:function(e){var n="<th>Model</th>",r="<th><em> log </em>L</th>",s='<th><abbr title="Number of estimated model parameters"># par.</abbr></th>',i='<th><abbr title="Small Sample AIC">AIC<sub>c</sub></abbr></th>',o="<th>Time to fit</th>",l='<th><abbr title="Total tree length, expected substitutions/site">L<sub>tree</sub></abbr></th>',c="<th>Branch set</th>",m="<th>&omega;<sub>1</sub></th>",d="<th>&omega;<sub>2</sub></th>",u="<th>&omega;<sub>3</sub></th>",p=[n,r,s,i,o,l,c,m,d,u];if(0==e.length)return[];var h=a.take(p,e[0].length);t.transpose(e);return h},componentDidUpdate:function(){var e=t.select("#summary-model-header1");e=e.selectAll("th").data(this.state.table_columns),e.enter().append("th"),e.html(function(e){return e});var n=t.select("#summary-model-table").selectAll("tr").data(this.state.table_row_data);n.enter().append("tr"),n.exit().remove(),n=n.selectAll("td").data(function(e){return e}),n.enter().append("td"),n.html(function(e){return e})},componentWillReceiveProps:function(e){var t=this.getModelRows(e.json),n=this.getModelColumns(t);this.setState({table_row_data:t,table_columns:n})},render:function(){return o.createElement("div",{className:"col-lg-12"},o.createElement("ul",{className:"list-group"},o.createElement("li",{className:"list-group-item"},o.createElement("h4",{className:"list-group-item-heading"},o.createElement("i",{className:"fa fa-cubes",styleFormat:"margin-right: 10px"}),"Model fits"),o.createElement("table",{className:"table table-hover table-condensed list-group-item-text",styleFormat:"margin-top:0.5em;"},o.createElement("thead",{id:"summary-model-header1"}),o.createElement("tbody",{id:"summary-model-table"})))))}});e.exports.ModelFits=l,e.exports.render_model_fits=s,e.exports.rerender_model_fits=i}).call(t,n(40),n(43),n(2))},204:function(e,t,n){(function(t,a){"use strict";function r(e,t){i.render(i.createElement(l,{json:e}),a(t)[0])}function s(e,t){a(t).empty(),r(e,t)}var i=n(46),o=n(43),l=i.createClass({displayName:"TreeSummary",getInitialState:function(){var e=this.getSummaryRows(this.props.json),t=this.getTreeSummaryColumns(e);return{table_row_data:e,table_columns:t}},getRateClasses:function(e){var t=o.values(e);return o.countBy(t,function(e){return e.omegas.length})},getBranchProportion:function(e){var n=o.reduce(o.values(e),function(e,t){return e+t});return o.mapObject(e,function(e,a){return t.format(".2p")(e/n)})},getBranchLengthProportion:function(e,n,a){var r=this,s=o.mapObject(e,function(e){return 0});for(var i in n){var l=r.tree.get_node_by_name(i);s[n[i].omegas.length]+=r.tree.branch_length()(l)}return o.mapObject(s,function(e,n){return t.format(".2p")(e/a)})},getNumUnderSelection:function(e,t,n){var a=o.mapObject(e,function(e){return 0});for(var r in t)a[t[r].omegas.length]+=n[r].p<=.05;return a},getSummaryRows:function(e){var n=this,a=e;if(!a)return[];var r=o.map(a.fits,function(e){return t.layout.phylotree("body")(e["tree string"])}),s=r[0];n.tree=s;var i=a.fits["Full model"]["tree length"],l=a.fits["Full model"]["branch-annotations"],c=a["test results"],m=this.getRateClasses(l),d=this.getBranchProportion(m),u=this.getBranchLengthProportion(m,l,i),p=this.getNumUnderSelection(m,l,c),h=o.keys(m),f=o.zip(h,o.values(m),o.values(d),o.values(u),o.values(p));return f.sort(function(e,t){return e[0]==t[0]?e[1]<t[1]?-1:e[1]==t[1]?0:1:e[0]-t[0]}),f},getTreeSummaryColumns:function(e){var t="<th>ω rate<br>classes</th>",n="<th># of <br>branches</th>",a="<th>% of <br>branches</th>",r="<th>% of tree <br>length</th>",s="<th># under <br>selection</th>",i=[t,n,a,r,s];if(0==e.length)return[];var l=o.take(i,e[0].length);return l},componentWillReceiveProps:function(e){var t=this.getSummaryRows(e.json),n=this.getTreeSummaryColumns(t);this.setState({table_row_data:t,table_columns:n})},componentDidUpdate:function(){t.select("#summary-tree-header").empty();var e=t.select("#summary-tree-header");e=e.selectAll("th").data(this.state.table_columns),e.enter().append("th"),e.html(function(e){return e});var n=t.select("#summary-tree-table").selectAll("tr").data(this.state.table_row_data);n.enter().append("tr"),n.exit().remove(),n=n.selectAll("td").data(function(e){return e}),n.enter().append("td"),n.html(function(e){return e})},render:function(){return i.createElement("ul",{className:"list-group"},i.createElement("li",{className:"list-group-item"},i.createElement("h4",{className:"list-group-item-heading"},i.createElement("i",{className:"fa fa-tree"}),"Tree"),i.createElement("table",{className:"table table-hover table-condensed list-group-item-text"},i.createElement("thead",{id:"summary-tree-header"}),i.createElement("tbody",{id:"summary-tree-table"}))))}});e.exports.TreeSummary=l,e.exports.render_tree_summary=r,e.exports.rerender_tree_summary=s}).call(t,n(40),n(2))},205:function(e,t,n){(function(t,a,r){"use strict";function s(e,t,n){return o.render(o.createElement(c,{json:e,settings:n}),r(t)[0])}function i(e,t,n){return r(t).empty(),s(e,n)}var o=n(46),l=n(39);n(206);var c=o.createClass({displayName:"Tree",getInitialState:function(){return{json:this.props.json,settings:this.props.settings}},sortNodes:function(e){var n=this;n.tree.traverse_and_compute(function(e){var n=1;e.children&&e.children.length&&(n+=t.max(e.children,function(e){return e.count_depth})),e.count_depth=n}),n.tree.resort_children(function(t,n){return(t.count_depth-n.count_depth)*(e?1:-1)})},getBranchLengths:function(){var e=this;if(!this.state.json)return[];var t=e.settings["tree-options"]["hyphy-tree-branch-lengths"][0]?this.state.json.fits[this.which_model]["branch-lengths"]:null;if(!t){var n=a.filter(e.tree.get_nodes(),function(e){return e.parent});t=a.object(a.map(n,function(e){return e.name}),a.map(n,function(e){return parseFloat(e.attribute)}))}return t},assignBranchAnnotations:function(){this.state.json&&this.state.json.fits[this.which_model]&&this.tree.assign_attributes(this.state.json.fits[this.which_model]["branch-annotations"])},renderDiscreteLegendColorScheme:function(e){var n=this,a=n.svg,r=n.settings["tree-options"]["hyphy-tree-fill-color"][0]?"black":"red",s={bottom:30,top:15,left:40,right:2};t.selectAll("#color-legend").remove();var i=a.append("g").attr("id","color-legend").attr("class","dc-legend").attr("transform","translate("+s.left+","+s.top+")"),o=i.append("g").attr("class","dc-legend-item").attr("transform","translate(0,0)");o.append("rect").attr("width","13").attr("height","13").attr("fill",r),o.append("text").attr("x","15").attr("y","11").text("Foreground");var l=i.append("g").attr("class","dc-legend-item").attr("transform","translate(0,18)");l.append("rect").attr("width","13").attr("height","13").attr("fill","gray"),l.append("text").attr("x","15").attr("y","11").text("Background")},renderLegendColorScheme:function(e,n,a){var s=this,i=this.state.json.fits[this.which_model]["branch-annotations"],o=s.svg;if(t.selectAll(".legend-definitions").selectAll("linearGradient").remove(),t.selectAll("#color-legend").remove(),i&&!a){var l=70,c=300,m={bottom:30,top:15,left:40,right:2},d=o.append("defs").attr("class","legend-definitions").append("linearGradient").attr("id","_omega_bar").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%"),u=t.scale.pow().exponent(this.scaling_exponent).domain(t.extent(s.omega_color.domain())).range([0,1]),p=t.scale.pow().exponent(this.scaling_exponent).domain(t.extent(s.omega_color.domain())).range([0,c-m.top-m.bottom]);s.omega_color.domain().forEach(function(e){d.append("stop").attr("offset",""+100*u(e)+"%").style("stop-color",s.omega_color(e))});var h=o.append("g").attr("id","color-legend").attr("transform","translate("+m.left+","+m.top+")");h.append("rect").attr("x",0).attr("width",l-m.left-m.right).attr("y",0).attr("height",c-m.top-m.bottom).style("fill","url(#_omega_bar)");var f=t.svg.axis().scale(p).orient("left").tickFormat(t.format(".1r")).tickValues([0,.01,.1,.5,1,2,5,10]),g=h.append("g");g.style("font-size","14").attr("class","hyphy-omega-bar").call(f),g.selectAll("text").style("text-anchor","right");var v="",b=v=g.append("g").attr("class","hyphy-omega-bar");b=b.selectAll("text").data([n]),b.enter().append("text"),b.text(function(e){return r("<textarea />").html(e).text()}).attr("transform","translate("+.5*(l-m.left-m.right)+","+(c-m.bottom)+")").style("text-anchor","middle").style("font-size","18").attr("dx","0.0em").attr("dy","0.1em")}},setHandlers:function(){var e=this;r("#hyphy-error-hide").on("click",function(e){t.select("#hyphy-error").style("display","none"),e.preventDefault()}),r(".hyphy-tree-trigger").on("click",function(t){e.renderTree()}),r(".tree-tab-btn").on("click",function(t){e.tree.placenodes().update()}),r("#export-phylo-svg").on("click",function(e){l.save_image("svg","#tree_container")}),r("#export-phylo-png").on("click",function(e){l.save_image("png","#tree_container")}),r("#export-phylo-nwk").on("click",function(t){var n=e.tree.get_newick(function(){}),a=document.createElement("a");a.setAttribute("href","data:text/octet-stream;charset=utf-8,"+encodeURIComponent(n)),a.setAttribute("download","nwk.txt"),r("body").append(a),a.click(),a.remove()})},setTreeHandlers:function(){var e=this,t=e.tree;r("[data-direction]").on("click",function(e){var n="vertical"==r(this).data("direction")?t.spacing_x:t.spacing_y;n(n()+ +r(this).data("amount")).update()}),r(".phylotree-layout-mode").on("change",function(e){r(this).is(":checked")&&t.radial()!=("radial"==r(this).data("mode"))&&t.radial(!t.radial()).placenodes().update()}),r(".phylotree-align-toggler").on("change",function(e){r(this).is(":checked")&&t.align_tips("right"==r(this).data("align"))&&t.placenodes().update()}),r("#sort_original").on("click",function(e){t.resort_children(function(e,t){return e.original_child_order-t.original_child_order}),e.preventDefault()}),r("#sort_ascending").on("click",function(t){e.sortNodes(!0),t.preventDefault()}),r("#sort_descending").on("click",function(t){e.sortNodes(!1),t.preventDefault()})},setPartitionList:function(){var e=this;if(!e.props.json.partition)return t.select("#hyphy-tree-highlight-div").style("display","none"),void t.select("#hyphy-tree-highlight").style("display","none");e.tree.set_partitions(e.props.json.partition);var n=t.select("#hyphy-tree-highlight-branches").selectAll("li").data([["None"]].concat(t.keys(e.props.json.partition).map(function(e){return[e]}).sort()));n.enter().append("li"),n.exit().remove(),n=n.selectAll("a").data(function(e){return e}),n.enter().append("a"),n.attr("href","#").on("click",function(n,a){t.select("#hyphy-tree-highlight").attr("value",n),e.renderTree()}),n.text(function(e){return"RELAX.test"==e&&this.click(),e})},setModelList:function(){var e=this;if(!this.state.json)return[];this.state.settings["suppress-tree-render"]=!0;var n=!1,a=t.select("#hyphy-tree-model-list").selectAll("li").data(t.keys(this.state.json.fits).map(function(e){return[e]}).sort());a.enter().append("li"),a.exit().remove(),a=a.selectAll("a").data(function(e){return e}),a.enter().append("a"),a.attr("href","#").on("click",function(n,a){t.select("#hyphy-tree-model").attr("value",n),e.renderTree()}),a.text(function(e){return"General Descriptive"==e&&(n=!0,this.click()),n||"Alternative"!=e||(n=!0,this.click()),n||"Partitioned MG94xREV"!=e||(n=!0,this.click()),n||"MG94"!=e||(n=!0,this.click()),n||"Full model"!=e||(n=!0,this.click()),e}),this.settings["suppress-tree-render"]=!1},initialize:function(){if(this.settings=this.state.settings,!this.settings)return null;if(!this.state.json)return null;r("#hyphy-tree-branch-lengths").click(),this.scaling_exponent=.33,this.omega_format=t.format(".3r"),this.prop_format=t.format(".2p"),this.fit_format=t.format(".2f"),this.p_value_format=t.format(".4f");this.state.json;this.width=800,this.height=600,this.which_model=this.settings["tree-options"]["hyphy-tree-model"][0],this.legend_type=this.settings["hyphy-tree-legend-type"],this.setHandlers(),this.setModelList(),this.initializeTree(),this.setPartitionList()},initializeTree:function(){var e=this,n=e.state.json,a=this.width,r=this.height;this.tree||(this.tree=t.layout.phylotree("body").size([r,a]).separation(function(e,t){return 0})),this.setTreeHandlers(),t.select("#tree_container").html(""),this.svg=t.select("#tree_container").append("svg").attr("width",a).attr("height",r),this.tree.branch_name(null),this.tree.node_span("equal"),this.tree.options({"draw-size-bubbles":!1,selectable:!1,"left-right-spacing":"fit-to-size","left-offset":100,"color-fill":this.settings["tree-options"]["hyphy-tree-fill-color"][0]},!1),this.assignBranchAnnotations(),e.omega_color=t.scale.pow().exponent(this.scaling_exponent).domain([0,.25,1,5,10]).range(this.settings["tree-options"]["hyphy-tree-fill-color"][0]?["#DDDDDD","#AAAAAA","#888888","#444444","#000000"]:["#5e4fa2","#3288bd","#e6f598","#f46d43","#9e0142"]).clamp(!0),e.renderTree(),"discrete"==e.legend_type?e.renderDiscreteLegendColorScheme("tree_container"):e.renderLegendColorScheme("tree_container",n.fits[this.which_model]["annotation-tag"]),this.settings.edgeColorizer&&(this.edgeColorizer=this.settings.edgeColorizer),this.tree.style_edges(this.edgeColorizer),this.tree.style_nodes(this.nodeColorizer),this.tree.spacing_x(30,!0),this.tree.layout(),this.tree.placenodes().update(),this.tree.layout()},renderTree:function(e){var n=this,r=this.state.json,s=n.svg;if(!this.settings["suppress-tree-render"]){var i=!1;for(var o in this.settings["tree-options"])if("hyphy-tree-model"==o){var l=t.select("#"+o),c=l.attr("value")||l.property("checked");c!=this.settings["tree-options"][o][0]&&0!=c&&(this.settings["tree-options"][o][0]=c,i=i||this.settings["tree-options"][o][1])}else{var l=t.select("#"+o),c=l.attr("value")||l.property("checked");c!=this.settings["tree-options"][o][0]&&(this.settings["tree-options"][o][0]=c,i=i||this.settings["tree-options"][o][1])}if(n.which_model!=this.settings["tree-options"]["hyphy-tree-model"][0])return n.which_model=this.settings["tree-options"]["hyphy-tree-model"][0],void n.initializeTree();a.indexOf(a.keys(r),"tree")>-1?this.tree(r.tree).svg(s):this.tree(r.fits[n.which_model]["tree string"]).svg(s),this.branch_lengths=this.getBranchLengths(),this.tree.font_size(18),this.tree.scale_bar_font_size(14),this.tree.node_circle_size(0),this.tree.branch_length(function(e){if(n.branch_lengths)return n.branch_lengths[e.name]||0}),this.assignBranchAnnotations(),a.findKey(r,"partition")?this.partition=(this.settings["tree-options"]["hyphy-tree-highlight"]?r.partition[this.settings["tree-options"]["hyphy-tree-highlight"][0]]:null)||null:this.partition=null,n.omega_color=t.scale.pow().exponent(n.scaling_exponent).domain([0,.25,1,5,10]).range(n.settings["tree-options"]["hyphy-tree-fill-color"][0]?["#DDDDDD","#AAAAAA","#888888","#444444","#000000"]:["#5e4fa2","#3288bd","#e6f598","#f46d43","#9e0142"]).clamp(!0),n.tree.options({"color-fill":n.settings["tree-options"]["hyphy-tree-fill-color"][0]},!1),t.select(".phylotree-definitions").selectAll("linearGradient").remove(),this.settings["tree-options"]["hyphy-tree-hide-legend"][0]?t.select("#color-legend").style("visibility","hidden"):(t.select("#color-legend").style("visibility","visible"),n.legend_type?n.renderDiscreteLegendColorScheme("tree_container"):n.renderLegendColorScheme("tree_container",n.state.json.fits[n.which_model]["annotation-tag"])),e||i&&this.tree.update_layout()}},componentDidMount:function(){this.initialize()},componentWillReceiveProps:function(e){this.setState({json:e.json,settings:e.settings})},componentDidUpdate:function(){this.initialize()},render:function(){return o.createElement("div",null,o.createElement("div",{className:"row"},o.createElement("div",{className:"cold-md-12"},o.createElement("div",{className:"input-group input-group-sm"},o.createElement("div",{className:"input-group-btn"},o.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},"Export",o.createElement("span",{className:"caret"})),o.createElement("ul",{className:"dropdown-menu"},o.createElement("li",{id:"export-phylo-png"},o.createElement("a",{href:"#"},o.createElement("i",{className:"fa fa-image"})," Image")),o.createElement("li",{id:"export-phylo-nwk"},o.createElement("a",{href:"#"},o.createElement("i",{className:"fa fa-file-o"})," Newick File"))),o.createElement("button",{type:"button",className:"btn btn-default btn-sm","data-direction":"vertical","data-amount":"1",title:"Expand vertical spacing"},o.createElement("i",{className:"fa fa-arrows-v"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm","data-direction":"vertical","data-amount":"-1",title:"Compress vertical spacing"},o.createElement("i",{className:"fa  fa-compress fa-rotate-135"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm","data-direction":"horizontal","data-amount":"1",title:"Expand horizonal spacing"},o.createElement("i",{className:"fa fa-arrows-h"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm","data-direction":"horizontal","data-amount":"-1",title:"Compress horizonal spacing"},o.createElement("i",{className:"fa  fa-compress fa-rotate-45"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm",id:"sort_ascending",title:"Sort deepest clades to the bototm"},o.createElement("i",{className:"fa fa-sort-amount-asc"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm",id:"sort_descending",title:"Sort deepsest clades to the top"},o.createElement("i",{className:"fa fa-sort-amount-desc"})),o.createElement("button",{type:"button",className:"btn btn-default btn-sm",id:"sort_original",title:"Restore original order"},o.createElement("i",{className:"fa fa-sort"}))),o.createElement("div",{className:"input-group-btn","data-toggle":"buttons"},o.createElement("label",{className:"btn btn-default active btn-sm"},o.createElement("input",{type:"radio",name:"options",className:"phylotree-layout-mode","data-mode":"linear",autoComplete:"off",checked:"",title:"Layout left-to-right"}),"Linear"),o.createElement("label",{className:"btn btn-default  btn-sm"
},o.createElement("input",{type:"radio",name:"options",className:"phylotree-layout-mode","data-mode":"radial",autoComplete:"off",title:"Layout radially"})," Radial")),o.createElement("div",{className:"input-group-btn","data-toggle":"buttons"},o.createElement("label",{className:"btn btn-default active btn-sm"},o.createElement("input",{type:"radio",className:"phylotree-align-toggler","data-align":"left",name:"options-align",autoComplete:"off",checked:"",title:"Align tips labels to branches"}),o.createElement("i",{className:"fa fa-align-left"})),o.createElement("label",{className:"btn btn-default btn-sm"},o.createElement("input",{type:"radio",className:"phylotree-align-toggler","data-align":"right",name:"options-align",autoComplete:"off",title:"Align tips labels to the edge of the plot"}),o.createElement("i",{className:"fa fa-align-right"}))),o.createElement("div",{className:"input-group-btn"},o.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},"Model",o.createElement("span",{className:"caret"})),o.createElement("ul",{className:"dropdown-menu",id:"hyphy-tree-model-list"})),o.createElement("input",{type:"text",className:"form-control disabled",id:"hyphy-tree-model",disabled:!0}),o.createElement("div",{id:"hyphy-tree-highlight-div",className:"input-group-btn"},o.createElement("button",{type:"button",className:"btn btn-default dropdown-toggle","data-toggle":"dropdown"},"Highlight branch set",o.createElement("span",{className:"caret"})),o.createElement("ul",{className:"dropdown-menu",id:"hyphy-tree-highlight-branches"})),o.createElement("input",{type:"text",className:"form-control disabled",id:"hyphy-tree-highlight",disabled:!0}),o.createElement("span",{className:"input-group-addon"},"Use model branch lengths",o.createElement("input",{type:"checkbox",id:"hyphy-tree-branch-lengths",className:"hyphy-tree-trigger"})),o.createElement("span",{className:"input-group-addon"},"Hide legend",o.createElement("input",{type:"checkbox",id:"hyphy-tree-hide-legend",className:"hyphy-tree-trigger"})),o.createElement("span",{className:"input-group-addon"},"Grayscale",o.createElement("input",{type:"checkbox",id:"hyphy-tree-fill-color",className:"hyphy-tree-trigger"}))))),o.createElement("div",{className:"row"},o.createElement("div",{className:"col-md-12"},o.createElement("div",{className:"row"},o.createElement("div",{id:"tree_container",className:"tree-widget"})))))}});e.exports.Tree=c,e.exports.render_tree=s,e.exports.rerender_tree=i}).call(t,n(40),n(43),n(2))},207:function(e,t,n){(function(t,a,r){"use strict";function s(e,t,n,a){l.render(l.createElement(c,{tree:e,test_results:t,annotations:n}),r(a)[0])}function i(e,t,n,a){r(a).empty(),s(e,t,n,a)}var o=n(208),l=n(46),c=l.createClass({displayName:"BranchTable",getInitialState:function(){var e=this.getBranchRows(this.props.tree,this.props.test_results,this.props.annotations),n=this.getBranchColumns(e),a=t.take(t.keys(this.props.annotations)),r=this.props.annotations?this.props.annotations[a].omegas:null,s={dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:15,top:35},legend:!1,domain:[1e-5,1e4],do_log_plot:!0,k_p:null,plot:null,svg_id:"prop-chart"};return{tree:this.props.tree,test_results:this.props.test_results,annotations:this.props.annotations,table_row_data:e,table_columns:n,current_model_name:a,current_omegas:r,distro_settings:s}},getBranchLength:function(e){return this.state.tree?a.format(".4f")(this.state.tree.get_node_by_name(e).attribute):""},getLRT:function(e){var t=a.format(".4f")(e.LRT);return"NaN"==t?e.LRT:t},getPVal:function(e){return a.format(".4f")(e.p)},getUncorrectedPVal:function(e){return a.format(".4f")(e["uncorrected p"])},getOmegaDistribution:function(e,t){if(!t)return"";var n="";for(var r in t[e].omegas){var s=parseFloat(t[e].omegas[r].omega),i="∞";s<1e20&&(i=a.format(".3r")(s)),n+="&omega;<sub>"+(parseInt(r)+1)+"</sub> = "+i+" ("+a.format(".2p")(t[e].omegas[r].prop)+")<br/>"}return n},getBranchRows:function(e,t,n){var r=[];a.format(".3r"),a.format(".2p");for(var s in t){var i=[],o=t[s];i=[s,this.getBranchLength(s),this.getLRT(o),this.getPVal(o),this.getUncorrectedPVal(o),this.getOmegaDistribution(s,n)],r.push(i)}return r.sort(function(e,t){return e[0]==t[0]?e[1]<t[1]?-1:e[1]==t[1]?0:1:e[3]-t[3]}),r},setEvents:function(){var e=this;if(e.state.annotations){var t=a.select("#table-branch-table").selectAll("tr");t.on("click",function(t){var n=t[0];e.setState({current_model_name:n,current_omegas:e.state.annotations[n].omegas})})}},createDistroChart:function(){this.settings={dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:15,top:15},has_zeros:!0,legend_id:null,do_log_plot:!0,k_p:null,plot:null,svg_id:"prop-chart"}},getBranchColumns:function(e){if(e.length<=0)return null;var n="<th>Name</th>",r='<th><abbr title="Branch Length">B</abbr></th>',s='<th><abbr title="Likelihood ratio test statistic">LRT</abbr></th>',i="<th>Test p-value</th>",o="<th>Uncorrected p-value</th>",l="<th>ω distribution over sites</th>",c=[n,r,s,i,o,l],m=t.take(c,e[0].length);a.transpose(e);return m},componentWillReceiveProps:function(e){var n=this.getBranchRows(e.tree,e.test_results,e.annotations),a=this.getBranchColumns(n),r=t.take(t.keys(e.annotations)),s=e.annotations?e.annotations[r].omegas:null,i={dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:15,top:15},legend:!1,domain:[1e-5,1e4],do_log_plot:!0,k_p:null,plot:null,svg_id:"prop-chart"};e.test_results&&e.annotations&&this.setState({tree:e.tree,test_results:e.test_results,annotations:e.annotations,table_row_data:n,table_columns:a,current_model_name:r,current_omegas:s,distro_settings:i})},componentDidUpdate:function(){var e=a.select("#table-branch-header");e=e.selectAll("th").data(this.state.table_columns),e.enter().append("th"),e.html(function(e){return e});var t=a.select("#table-branch-table").selectAll("tr").data(this.state.table_row_data);t.enter().append("tr"),t.exit().remove(),t.style("font-weight",function(e){return e[3]<=.05?"bold":"normal"}),t=t.selectAll("td").data(function(e){return e}),t.enter().append("td"),t.html(function(e){return e}),this.createDistroChart(),this.setEvents()},render:function(){var e=this;return l.createElement("div",{className:"row"},l.createElement("div",{id:"hyphy-branch-table",className:"col-md-7"},l.createElement("table",{className:"table table-hover table-condensed"},l.createElement("thead",{id:"table-branch-header"}),l.createElement("tbody",{id:"table-branch-table"}))),l.createElement("div",{id:"primary-omega-tag",className:"col-md-5"},l.createElement(o.PropChart,{name:e.state.current_model_name,omegas:e.state.current_omegas,settings:e.state.distro_settings})))}});e.exports.BranchTable=c,e.exports.render_branch_table=s,e.exports.rerender_branch_table=i}).call(t,n(43),n(40),n(2))},208:function(e,t,n){(function(t,a,r){"use strict";function s(e,t,n){return o.render(o.createElement(c,{name:e,omegas:t,settings:n}),document.getElementById("primary-omega-tag"))}function i(e,t,n){return r("#primary-omega-tag").empty(),s(e,t,n)}var o=n(46),l=n(39),c=o.createClass({displayName:"PropChart",getDefaultProps:function(){return{svg_id:null,dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:25,top:35},has_zeros:!1,legend_id:null,do_log_plot:!0,k_p:null,plot:null}},getInitialState:function(){return{model_name:this.props.name,omegas:this.props.omegas,settings:this.props.settings}},setEvents:function(){var e=this;t.select("#"+this.save_svg_id).on("click",function(t){l.save_image("svg","#"+e.svg_id)}),t.select("#"+this.save_png_id).on("click",function(t){l.save_image("png","#"+e.svg_id)})},initialize:function(){t.select("#prop-chart").html(""),this.data_to_plot=this.state.omegas,this.svg_id=this.props.settings.svg_id,this.dimensions=this.props.settings.dimensions||this.props.dimensions,this.margins=this.props.settings.margins||this.props.margins,this.legend_id=this.props.settings.legend||this.props.legend_id,this.do_log_plot=this.props.settings.log||this.props.do_log_plot,this.k_p=this.props.settings.k||this.props.k_p;var e=this.props.dimensions,n=this.props.margins;this.props.do_log_plot&&(this.has_zeros=this.data_to_plot.some(function(e){return e.omega<=0})),this.plot_width=e.width-n.left-n.right,this.plot_height=e.height-n.top-n.bottom;var a=this.state.settings.domain;this.omega_scale=(this.do_log_plot?this.has_zeros?t.scale.pow().exponent(.2):t.scale.log():t.scale.linear()).range([0,this.plot_width]).domain(a).nice(),this.proportion_scale=t.scale.linear().range([this.plot_height,0]).domain([-.05,1]).clamp(!0),this.svg=t.select("#"+this.svg_id).attr("width",e.width+n.left+n.right).attr("height",e.height+n.top+n.bottom),this.plot=this.svg.selectAll(".container"),this.svg.selectAll("defs").remove(),this.svg.append("defs").append("marker").attr("id","arrowhead").attr("refX",10).attr("refY",4).attr("markerWidth",10).attr("markerHeight",8).attr("orient","auto").attr("stroke","#000").attr("fill","#000").append("path").attr("d","M 0,0 V8 L10,4 Z"),this.plot.empty()&&(this.plot=this.svg.append("g").attr("class","container")),this.plot.attr("transform","translate("+this.margins.left+" , "+this.margins.top+")"),this.reference_omega_lines=this.plot.selectAll(".hyphy-omega-line-reference"),this.displacement_lines=this.plot.selectAll(".hyphy-displacement-line"),this.createNeutralLine(),this.createXAxis(),this.createYAxis(),this.setEvents(),this.createOmegaLine(this.state.omegas),console.log("initialized everything"),console.log(this.svg)},createOmegaLine:function(e){var t=this;this.data_to_plot;t.colores_g=a.shuffle(["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"]);var n=this.plot.selectAll(".hyphy-omega-line").data(e);n.enter().append("line"),n.exit().remove(),n.transition().attr("x1",function(e){return t.omega_scale(e.omega)}).attr("x2",function(e){return t.omega_scale(e.omega)}).attr("y1",function(e){return t.proportion_scale(-.05)}).attr("y2",function(e){return t.proportion_scale(e.prop)}).style("stroke",function(e){var n=a.take(t.colores_g);return t.colores_g=a.rest(t.colores_g),n}).attr("class","hyphy-omega-line")},createNeutralLine:function(){var e=this,t=this.plot.selectAll(".hyphy-neutral-line").data([1]);t.enter().append("line").attr("class","hyphy-neutral-line"),t.exit().remove(),t.transition().attr("x1",function(t){return e.omega_scale(t)}).attr("x2",function(t){return e.omega_scale(t)}).attr("y1",0).attr("y2",this.plot_height)},createXAxis:function(){var e=t.svg.axis().scale(this.omega_scale).orient("bottom");this.do_log_plot&&e.ticks(10,this.has_zeros?".2r":".1r");var n,a=this.svg.selectAll(".x.axis");a.empty()?(a=this.svg.append("g").attr("class","x hyphy-axis"),n=a.append("g").attr("class","hyphy-axis-label x-label")):n=a.select(".axis-label.x-label"),a.attr("transform","translate("+this.margins.left+","+(this.plot_height+this.margins.top)+")").call(e),n=n.attr("transform","translate("+this.plot_width+","+this.margins.bottom+")").selectAll("text").data(["ω"]),n.enter().append("text"),n.text(function(e){return e}).style("text-anchor","end").attr("dy","0.0em")},createYAxis:function(){var e,n=t.svg.axis().scale(this.proportion_scale).orient("left").ticks(10,".1p"),a=this.svg.selectAll(".y.hyphy-axis");a.empty()?(a=this.svg.append("g").attr("class","y hyphy-axis"),e=a.append("g").attr("class","hyphy-axis-label y-label")):e=a.select(".hyphy-axis-label.y-label"),a.attr("transform","translate("+this.margins.left+","+this.margins.top+")").call(n),e=e.attr("transform","translate("+-this.margins.left+",0)").selectAll("text").data(["Proportion of sites"]),e.enter().append("text"),e.text(function(e){return e}).style("text-anchor","start").attr("dy","-1em")},componentDidMount:function(){try{this.initialize()}catch(e){}},componentWillReceiveProps:function(e){this.setState({model_name:e.name,omegas:e.omegas})},componentDidUpdate:function(){try{this.initialize()}catch(e){}},render:function(){return this.save_svg_id="export-"+this.svg_id+"-svg",this.save_png_id="export-"+this.svg_id+"-png",o.createElement("div",{className:"panel panel-default",id:this.state.model_name},o.createElement("div",{className:"panel-heading"},o.createElement("h3",{className:"panel-title"},o.createElement("strong",null,this.state.model_name)),o.createElement("p",null,"ω distribution"),o.createElement("div",{className:"btn-group"},o.createElement("button",{id:this.save_svg_id,type:"button",className:"btn btn-default btn-sm"},o.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," SVG"),o.createElement("button",{id:this.save_png_id,type:"button",className:"btn btn-default btn-sm"},o.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," PNG"))),o.createElement("div",{className:"panel-body"},o.createElement("svg",{id:this.svg_id})))}});e.exports.render_prop_chart=s,e.exports.rerender_prop_chart=i,e.exports.PropChart=c}).call(t,n(40),n(43),n(2))},209:function(e,t,n){(function(t,a){"use strict";function r(e){var n=t.format(".2f"),a=t.format(".2p"),r=t.format(".3r"),s=function(e){var t="";e=parseFloat(e);var n=[Math.floor(e/86400),Math.floor(e/3600)%24,Math.floor(e/60)%60,e%60],a=["d.","hrs.","min.","sec."];return n.forEach(function(e,n){e&&(t+=" "+e+" "+a[n])}),t},i={},o={},c=1,m=0,d=0,u=[];for(var p in e["test results"])i[p]=e["test results"].p,i[p]<=.05&&m++;var h=e.fits["Unconstrained model"]["rate distributions"];for(var f in h){try{u[c][2]=e["test results"][f].LRT,u[c][3]=e["test results"][f].p,u[c][4]=e["test results"][f]["uncorrected p"]}catch(e){}var g=h[f];o[f]=g,c+=1}t.format("g")(e.fits["Unconstrained model"]["tree length"]);u=u.sort(function(e,t){return e[4]-t[4]}),t.select("#summary-test-result").text(e["test results"].p<=.05?"evidence":"no evidence"),t.select("#summary-test-pvalue").text(t.format(".3f")(e["test results"].p)),t.select("#summary-pmid").text("PubMed ID "+e.PMID).attr("href","http://www.ncbi.nlm.nih.gov/pubmed/"+e.PMID),t.select("#summary-total-runtime").text(s(e.timers.overall)),t.select("#summary-total-branches").text(c),t.select("#summary-tested-branches").text(d),t.select("#summary-selected-branches").text(m),has_background=e.background;var v=[[],[]];for(has_background&&v.push([]),k=0;k<2+has_background;k++){var b,y,_=0;if(0===k)b="Unconstrained model",y="FG",v[k].push("Unconstrained Model"),_=0;else if(has_background&&1==k)v[k].push("(background branches)"),y="BG",_=1;else{if(b="Constrained model",!(b in e.fits))break;v[k].push("Constrained Model"),y="FG",_=0}try{for(v[k].push(_?"":n(e.fits[b]["log-likelihood"])),v[k].push(_?"":e.fits[b].parameters),v[k].push(_?"":n(e.fits[b]["AIC-c"])),v[k].push(_?"":s(e.fits[b].runtime)),v[k].push(_?"":n(e.fits[b]["tree length"])),j=0;j<3;j++)v[k].push(r(e.fits[b]["rate distributions"][y][j][0])+" ("+a(e.fits[b]["rate distributions"][y][j][1])+")")}catch(e){l.errorModal(e)}}v=t.select("#summary-model-table").selectAll("tr").data(v),v.enter().append("tr"),v.exit().remove(),v=v.selectAll("td").data(function(e){return e}),v.enter().append("td"),v.html(function(e){return e})}function s(e,n){var r=this;if(0===t.keys(n["evidence ratios"]).length)return t.selectAll(e).style("display","none"),t.selectAll(".dc-data-table").style("display","none"),t.selectAll("#er-thresholds").style("display","none"),void t.selectAll("#apply-thresholds").style("display","none");t.selectAll(e).style("display","block"),t.selectAll(".dc-data-table").style("display","table"),t.selectAll("#er-thresholds").style("display","block"),t.selectAll("#apply-thresholds").style("display","block");var s=n["evidence ratios"].constrained[0];s=s.map(function(e){return Math.log(e)});var c=(n["test set"].split(","),[]);s.forEach(function(e,t){c.push({site_index:t+1,unconstrained:n.profiles.unconstrained[0][t],constrained:n.profiles.constrained[0][t],optimized_null:n.profiles["optimized null"][0][t],er_constrained:Math.log(n["evidence ratios"].constrained[0][t]),er_optimized_null:Math.log(n["evidence ratios"]["optimized null"][0][t])})});var m=i(c),d=m.dimension(function(e){return e.site_index}),u=d.group().reduce(function(e,t){return e.constrained_evidence+=+t.er_constrained,e.optimized_null_evidence+=+t.er_optimized_null,e},function(e,t){return e.constrained_evidence-=+t.er_constrained,e.optimized_null_evidence-=+t.er_optimized_null,e},function(){return{constrained_evidence:0,optimized_null_evidence:0}}),p=d.group().reduce(function(e,t){return e.optimized_null_evidence+=+t.er_optimized_null,e},function(e,t){return e.optimized_null_evidence-=+t.er_optimized_null,e},function(){return{optimized_null_evidence:0}}),h=m.dimension(function(e){return e.er_constrained}),f=m.dimension(function(e){return e.er_optimized_null});r.er_constrained=h,r.er_optimized_null=f;var g=o.compositeChart(e);g.width(a(window).width()).height(300).dimension(d).x(t.scale.linear().domain([1,s.length])).yAxisLabel("2 * Ln Evidence Ratio").xAxisLabel("Site Location").legend(o.legend().x(a(window).width()-150).y(20).itemHeight(13).gap(5)).renderHorizontalGridLines(!0).compose([o.lineChart(g).group(u,"Constrained").colors(t.scale.ordinal().range(["green"])).valueAccessor(function(e){return 2*e.value.constrained_evidence}).keyAccessor(function(e){return e.key}),o.lineChart(g).group(p,"Optimized Null").valueAccessor(function(e){return 2*e.value.optimized_null_evidence}).keyAccessor(function(e){return e.key}).colors(t.scale.ordinal().range(["red"]))]),g.xAxis().ticks(50);var v=t.format(".4f");o.dataTable(".dc-data-table").dimension(d).group(function(e){return d.bottom(1)[0].site_index+" - "+d.top(1)[0].site_index}).size(d.groupAll().reduceCount().value()).columns([function(e){return e.site_index},function(e){return v(e.unconstrained)},function(e){return v(e.constrained)},function(e){return v(e.optimized_null)},function(e){return v(e.er_constrained)},function(e){return v(e.er_optimized_null)}]).sortBy(function(e){return e.site_index}).order(t.ascending).renderlet(function(e){e.selectAll(".dc-table-group").classed("info",!0)}),a("#export-csv").on("click",function(e){l.export_csv_button(d.top(1/0))}),a("#export-chart-svg").on("click",function(e){a("#chart-id").find("svg")[0].setAttribute("class","dc-chart"),l.save_image("svg","#chart-id"),a("#chart-id").find("svg")[0].setAttribute("class","")}),a("#export-chart-png").on("click",function(e){a("#chart-id").find("svg")[0].setAttribute("class","dc-chart"),l.save_image("png","#chart-id"),a("#chart-id").find("svg")[0].setAttribute("class","")}),a("#apply-thresholds").on("click",function(e){var t=document.getElementById("er-constrained-threshold").value,n=document.getElementById("er-optimized-null-threshold").value;r.er_constrained.filter(function(e){return e>=t}),r.er_optimized_null.filter(function(e){return e>=n}),o.renderAll()}),o.renderAll()}n(210);var i=n(212),o=n(215),l=n(39);e.exports.render_summary=r,e.exports.render_histogram=s}).call(t,n(40),n(2))},210:function(e,t){},216:function(e,t){},218:function(e,t,n){(function(t,a,r){"use strict";var s=n(205),i=n(203),o=(n(204),n(208));n(206),n(216);var l=n(46),c=n(!function(){var e=new Error('Cannot find module "react-dom"');throw e.code="MODULE_NOT_FOUND",e}()),m=n(39),d=n(209),u=l.createClass({displayName:"BUSTED",float_format:t.format(".2f"),p_value_format:t.format(".4f"),fit_format:t.format(".2f"),loadFromServer:function(){var e=this;t.json(this.props.url,function(t){t.fits["Unconstrained model"]["branch-annotations"]=e.formatBranchAnnotations(t,"Unconstrained model"),t.fits["Constrained model"]["branch-annotations"]=e.formatBranchAnnotations(t,"Constrained model"),t.fits["Unconstrained model"]["rate-distributions"]=t.fits["Unconstrained model"]["rate distributions"],t.fits["Constrained model"]["rate-distributions"]=t.fits["Constrained model"]["rate distributions"],t.fits["Unconstrained model"]["display-order"]=0,t.fits["Constrained model"]["display-order"]=1;var n=t,r="25701167",s="PubMed ID "+r,i="http://www.ncbi.nlm.nih.gov/pubmed/"+r,o=n["test results"].p,l=o<=.05?"evidence":"no evidence",c=n.fits["Unconstrained model"]["rate distributions"].FG,m={omegas:a.map(c,function(e){return a.object(["omega","prop"],e)})};e.setState({p:o,test_result:l,json:n,omegas:m.omegas,pmid_text:s,pmid_href:i})})},getDefaultProps:function(){var e=function(e,t){var n=t.target.annotations.is_foreground,a=this.options()["color-fill"]?"black":"red";e.style("stroke",n?a:"gray").style("stroke-linejoin","round").style("stroke-linejoin","round").style("stroke-linecap","round")},t={omegaPlot:{},"tree-options":{"hyphy-tree-model":["Unconstrained model",!0],"hyphy-tree-highlight":["RELAX.test",!1],"hyphy-tree-branch-lengths":[!0,!0],"hyphy-tree-hide-legend":[!0,!1],"hyphy-tree-fill-color":[!0,!1]},"hyphy-tree-legend-type":"discrete","suppress-tree-render":!1,"chart-append-html":!0,edgeColorizer:e},n={dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:35,top:35},legend:!1,domain:[1e-5,100],do_log_plot:!0,k_p:null,plot:null,svg_id:"prop-chart"};return{distro_settings:n,tree_settings:t,constrained_threshold:"Infinity",null_threshold:"-Infinity",model_name:"FG"}},getInitialState:function(){return{p:null,test_result:null,json:null,omegas:null,pmid_text:null,pmid_href:null}},setEvents:function(){var e=this;r("#json_file").on("change",function(t){var n=t.target.files;if(1==n.length){var s=n[0],i=new FileReader;i.onload=function(t){return function(t){var n=JSON.parse(this.result);n.fits["Unconstrained model"]["branch-annotations"]=e.formatBranchAnnotations(n,"Unconstrained model"),n.fits["Constrained model"]["branch-annotations"]=e.formatBranchAnnotations(n,"Constrained model"),n.fits["Unconstrained model"]["rate-distributions"]=n.fits["Unconstrained model"]["rate distributions"],n.fits["Constrained model"]["rate-distributions"]=n.fits["Constrained model"]["rate distributions"];var r=n,s="25701167",i="PubMed ID "+s,o="http://www.ncbi.nlm.nih.gov/pubmed/"+s,l=r["test results"].p,c=l<=.05?"evidence":"no evidence",m=r.fits["Unconstrained model"]["rate distributions"].FG,d={omegas:a.map(m,function(e){return a.object(["omega","prop"],e)})};e.setState({p:l,test_result:c,json:r,omegas:d.omegas,pmid_text:i,pmid_href:o})}}(s),i.readAsText(s)}r("#datamonkey-absrel-toggle-here").dropdown("toggle"),t.preventDefault()})},formatBranchAnnotations:function(e,n){var r=e["test set"].split(","),s=t.layout.phylotree(),i=s(e.fits[n]["tree string"]).get_nodes(),o=a.map(i,function(e){return e.name}),l=a.object(o,a.map(o,function(e){return{is_foreground:a.indexOf(r,e)>-1}}));return l},initialize:function(){var e=this.state.json;if(e){d.render_histogram("#chart-id",e),t.select("#tree_container").select("svg").remove();var n=e.fits["Unconstrained model"]["rate distributions"].FG;n.map(function(e){return e[0]}),n.map(function(e){return e[1]});r("#export-dist-svg").on("click",function(e){m.save_image("svg","#primary-omega-dist")}),r("#export-dist-png").on("click",function(e){m.save_image("png","#primary-omega-dist")})}},componentWillMount:function(){this.loadFromServer(),this.setEvents()},render:function(){var e=this;return e.initialize(),l.createElement("div",{className:"tab-content"},l.createElement("div",{className:"tab-pane active",id:"summary_tab"},l.createElement("div",{className:"row",styleName:"margin-top: 5px"},l.createElement("div",{className:"col-md-12"},l.createElement("ul",{className:"list-group"},l.createElement("li",{className:"list-group-item list-group-item-info"},l.createElement("h3",{className:"list-group-item-heading"},l.createElement("i",{className:"fa fa-list",styleName:"margin-right: 10px"}),l.createElement("span",{id:"summary-method-name"},"BUSTED")," summary"),"There is ",l.createElement("strong",null,this.state.test_result)," of episodic diversifying selection, with LRT p-value of ",this.state.p,".",l.createElement("p",null,l.createElement("small",null,"Please cite ",l.createElement("a",{href:this.state.pmid_href,id:"summary-pmid"},this.state.pmid_text)," if you use this result in a publication, presentation, or other scientific work.")))))),l.createElement("div",{className:"row"},l.createElement("div",{id:"hyphy-model-fits",className:"col-lg-12"},l.createElement(i.ModelFits,{json:e.state.json}))),l.createElement("button",{id:"export-chart-svg",type:"button",className:"btn btn-default btn-sm pull-right btn-export"},l.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," Export Chart to SVG"),l.createElement("button",{id:"export-chart-png",type:"button",className:"btn btn-default btn-sm pull-right btn-export"},l.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," Export Chart to PNG"),l.createElement("div",{className:"row hyphy-busted-site-table"},l.createElement("div",{id:"chart-id",className:"col-lg-8"},l.createElement("strong",null,"Model Evidence Ratios Per Site"),l.createElement("div",{className:"clearfix"}))),l.createElement("div",{className:"row site-table"},l.createElement("div",{className:"col-lg-12"},l.createElement("form",{id:"er-thresholds"},l.createElement("div",{className:"form-group"},l.createElement("label",{for:"er-constrained-threshold"},"Constrained Evidence Ratio Threshold:"),l.createElement("input",{type:"text",className:"form-control",id:"er-constrained-threshold",defaultValue:this.props.constrained_threshold})),l.createElement("div",{className:"form-group"},l.createElement("label",{for:"er-optimized-null-threshold"},"Optimized Null Evidence Ratio Threshold:"),l.createElement("input",{type:"text",className:"form-control",id:"er-optimized-null-threshold",defaultValue:this.props.null_threshold}))),l.createElement("button",{id:"export-csv",type:"button",className:"btn btn-default btn-sm pull-right hyphy-busted-btn-export"},l.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," Export Table to CSV"),l.createElement("button",{id:"apply-thresholds",type:"button",className:"btn btn-default btn-sm pull-right hyphy-busted-btn-export"},"Apply Thresholds"),l.createElement("table",{id:"sites",className:"table sites dc-data-table"},l.createElement("thead",null,l.createElement("tr",{className:"header"},l.createElement("th",null,"Site Index"),l.createElement("th",null,"Unconstrained Likelihood"),l.createElement("th",null,"Constrained Likelihood"),l.createElement("th",null,"Optimized Null Likelihood"),l.createElement("th",null,"Constrained Evidence Ratio"),l.createElement("th",null,"Optimized Null Evidence Ratio"))))))),l.createElement("div",{className:"tab-pane",id:"tree_tab"},l.createElement("div",{className:"col-md-12"},l.createElement(s.Tree,{json:e.state.json,settings:e.props.tree_settings})),l.createElement("div",{className:"col-md-12"},l.createElement("div",{id:"primary-omega-dist",className:"panel-body"},l.createElement(o.PropChart,{name:e.props.model_name,omegas:e.state.omegas,settings:e.props.distro_settings})))))}}),p=function(e,t){c.render(l.createElement(u,{url:e}),document.getElementById(t))};e.exports=p}).call(t,n(40),n(43),n(2))},219:function(e,t,n){(function(t,n){"use strict";var a=function(e){var a=(t.interpolateRgb(t.rgb(0,0,255),t.rgb(255,255,255)),t.interpolateRgb(t.rgb(255,255,255),t.rgb(255,0,0)),!1),r=e.results.FADE,s=function(e){ar=[];for(var t in e)ar.push(e[t]);return ar},i=function(e){ar=[];for(var t in e)ar.push(t);return ar},o=function(e){for(var t=[parseInt(e[0])],n=4;n<e.length;n+=5)t.push(e[n]);return t},l=function(e){for(var t=[parseInt(e[0])],n=5;n<e.length;n+=5)t.push(e[n]);return t},c=function(e){for(var t=1;t<21;t++)if(e[t]>this)return!0;return!1},m=function(){n("#filter_on_pvalue").trigger("submit"),g("property_plot_svg",r)},d=function(e){var s=[["Site","A","C","D","E","F","G","H","I","K","L","M","N","P","Q","R","S","T","V","W","Y"],["Site","Alanine","Cysteine","Aspartic acid","Glutamic acid","Phenylalanine","Glycine","Histidine","Isoleucine","Lysine","Leucine","Methionine","Asparagine","Proline","Glutamine","Arginine","Serine","Threonine","Valine","Tryptophan","Tyrosin"]],i="";n("body").attr("data-job-id",e),n("#filter_on_pvalue").submit(function(e){return cutoff=parseFloat(n("#pvalue")[0].value),i=a?v("prime_table",s,r,l,c):v("prime_table",s,r,o,c),t.select("#total_sites_found").selectAll("span").data(i).html(function(e){return e}),!1}),n("#site_rate_display").on("show",function(e){return!0}),n("body").on("click",'[data-toggle="modal"]',function(e){p(n(this).attr("data-codon-id"))}),n("#set-p-value").click(function(e){t.select("#pq_selector").html("Posterior <span class='caret'></span>"),a=!1,e.preventDefault()}),n("#set-q-value").click(function(e){t.select("#pq_selector").html("BF <span class='caret'></span>"),a=!0,e.preventDefault()}),n("body").on("click","#property_selector .btn",function(e){e.stopPropagation(),"button"!=n(this).attr("data-toggle")&&n(this).toggleClass("active"),h("property_plot_svg",parseInt(n(this).attr("data-property-id")),n(this).hasClass("active"))})},u=!1,p=function(e){job_id=n("body").attr("data-job-id"),url="/cgi-bin/datamonkey/wrapHyPhyBF.pl?file=fade_site&mode=1&arguments="+job_id+"-"+e,t.json(url,function(t){f(t,e)})},h=function(e,n,a){a?prop="visible":prop="hidden",t.select("#"+e).selectAll(".dot"+n).style("visibility",prop)},f=function(e,n){t.select("#site_rate_display_header").html("Detailed information about site "+n),elements=s(e),headers=i(elements[0]).sort();var a=t.select("#site_info_table").select("thead");a.selectAll("th").remove(),a.selectAll("th").data(headers).enter().append("th").html(function(e,t){return e})},g=function(e,n){if(!u){n=n.map(o),u=!0;var a=n.length,r={top:20,right:40,bottom:30,left:40},s=800-r.left-r.right,i=500-r.top-r.bottom,l=t.scale.linear().range([0,s]),c=t.scale.linear().range([i,0]),m=t.scale.category10(),d=t.svg.axis().scale(l).orient("bottom"),p=t.svg.axis().scale(c).orient("left"),h=t.svg.axis().scale(c).orient("right"),f=function(){return t.svg.axis().scale(l).orient("bottom").ticks(20)},g=function(){return t.svg.axis().scale(c).orient("left").ticks(20)},v=t.select("#"+e).attr("width",s+r.left+r.right).attr("height",i+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")");l.domain([1,a]),c.domain([0,1]),v.append("g").attr("class","x hyphy-axis").attr("transform","translate(0,"+i+")").call(d).append("text").attr("x",s).attr("y",30).style("text-anchor","end").text("Site index"),v.append("g").attr("class","grid").call(g().tickSize(-s,0,0).tickFormat("")),v.append("g").attr("class","grid").attr("transform","translate(0,"+i+")").call(f().tickSize(-i,0,0).tickFormat("")),v.append("g").attr("class","y hyphy-axis").call(p).append("text").attr("transform","rotate(-90)").attr("y",-37).attr("dy",".71em").style("text-anchor","end").text("P(Bias>1)");var b=v.append("g").attr("class","y hyphy-axis").attr("transform","translate("+s+",0)").call(h.tickFormat(""));b.append("text").attr("transform","rotate(-90)").attr("y",10).attr("dy",".71em").style("text-anchor","end").text("High Posteriors"),b.append("text").attr("transform","rotate(-90)").attr("y",10).attr("x",-i).attr("dy",".71em").style("text-anchor","start").text("Low Posteriors");var y=(v.selectAll(".legend").data(m.domain()).enter().append("g").attr("class","legend").attr("transform",function(e,t){return"translate(0,"+20*t+")"}),{});y[1]="Alanine",y[2]="Cysteine",y[3]="Aspartic acid",y[4]="Glutamic acid",y[5]="Phenylalanine",y[6]="Glycine",y[7]="Histidine",y[8]="Isoleucine",y[9]="Lysine",y[10]="Leucine",y[11]="Methionine",y[12]="Asparagine",y[13]="Proline",y[14]="Glutamine",y[15]="Arginine",y[16]="Serine",y[17]="Threonine",y[18]="Valine",y[19]="Tryptophan",y[20]="Tyrosine";for(var _="visible",E=1;E<=20;E++)E>1&&(_="hidden"),v.selectAll(".dot"+E).data(n).enter().append("circle").attr("class","dot"+E).attr("r",function(e){return 0==e[E]?1:3.5}).attr("cx",function(e){return l(e[0])}).attr("cy",function(e){return c(e[E])}).style("fill",function(e){return m(E)}).style("opacity",.5).style("visibility",_).append("title").text(function(e){return"Site "+e[0]+", "+y[E]+" P(Beta>1) ="+e[E]}),t.select("#show_property"+E).style("color",function(e){return m(E)});
}},v=function(e,r,s,i,o){var l=t.select("#"+e).select("thead");l.selectAll("th").remove(),l.selectAll("th").data(r[0]).enter().append("th").html(function(e,t){return"<a href='#' data-toggle='tooltip' data-placement = 'right' data-html = true title data-original-title='"+r[1][t]+"'>"+e+"</a>"});var c=t.select("#"+e).select("tbody");c.selectAll("tr").remove();var m=s.map(i).filter(o,cutoff),d=c.selectAll("tr").data(function(e){return m}),u=0;return d.enter().append("tr").selectAll("td").data(function(e){return e}).enter().append("td").html(function(e,t){return e=parseFloat(e),t?0==a?e>.99?"1.00":e.toFixed(2):e>100?"100+":e.toFixed(1):"<b>"+e+"</b> <a href='#site_rate_display' data-toggle='modal' data-codon-id = '"+e+"' data-placement = 'bottom'><i class='icon-list'></i></a>"}).classed("btn-danger",function(e,t,n){return e>=cutoff&&t>=1&&(u++,!0)}),t.select("#"+e).classed("table-striped table-hover",!0),n("a").tooltip(),[m.length,u]};d("test"),m()};e.exports=a}).call(t,n(40),n(2))},220:function(e,t,n){(function(t){"use strict";function a(e,t){r.render(r.createElement(s,{fade_results:e,msa:t}),document.getElementById("summary-div"))}var r=n(46),s=r.createClass({displayName:"FadeSummary",float_format:t.format(".2f"),countBranchesTested:function(e){return e?e.split(";").length:0},getDefaultProps:function(){return{subs:[]}},componentDidMount:function(){this.setProps({alpha_level:.05,sequences:this.props.msa.sequences,subs:this.props.fade_results.TREE_LENGTHS[0],sites:this.props.msa.sites,model:this.props.fade_results.MODEL_INFO,grid_desc:this.props.fade_results.GRID_DESCRIPTION,branches_tested:this.props.fade_results.BRANCHES_TESTED})},render:function(){var e=this;return r.createElement("dl",{className:"dl-horizontal"},r.createElement("dt",null,"Data summary"),r.createElement("dd",null,this.props.sequences," sequences with ",this.props.partitions," partitions."),r.createElement("dd",null,r.createElement("div",{className:"alert"},"These sequences have not been screened for recombination. Selection analyses of alignments with recombinants in them using a single tree may generate ",r.createElement("u",null,"misleading")," results.")),this.props.msa.partition_info.map(function(t,n){return r.createElement("div",null,r.createElement("dt",null,"Partition ",t.partition),r.createElement("dd",null," ",e.float_format(e.props.subs[n])," subs/ aminoacid  site"),r.createElement("dd",null,t.endcodon-t.startcodon," aminoacids"))}),r.createElement("dt",null,"Settings"),r.createElement("dd",null,this.props.model),r.createElement("dd",null,this.props.grid_desc),r.createElement("dd",null,"Directional model applied to ",e.countBranchesTested(this.props.branches_tested)," branches"))}});e.exports=a}).call(t,n(40))},221:function(e,t,n){(function(t,a){"use strict";function r(e,t){l.render(l.createElement(m,{url:e}),document.getElementById(t))}var s=n(203),i=(n(204),n(205)),o=n(222),l=n(46),c=n(43),m=l.createClass({displayName:"RELAX",float_format:t.format(".2f"),p_value_format:t.format(".4f"),fit_format:t.format(".2f"),loadFromServer:function(){var e=this;t.json(this.props.url,function(t){t.fits["Partitioned MG94xREV"]["branch-annotations"]=e.formatBranchAnnotations(t,"Partitioned MG94xREV"),t.fits["General Descriptive"]["branch-annotations"]=e.formatBranchAnnotations(t,"General Descriptive"),t.fits.Null["branch-annotations"]=e.formatBranchAnnotations(t,"Null"),t.fits.Alternative["branch-annotations"]=e.formatBranchAnnotations(t,"Alternative"),t.fits["Partitioned Exploratory"]["branch-annotations"]=e.formatBranchAnnotations(t,"Partitioned Exploratory");var n=t.fits["Partitioned MG94xREV"]["branch-annotations"],a=t,r=t.PMID,s=t.relaxation_test,i=t["relaxation-test"].p,o=t.fits.Alternative.K>1?"intensification":"relaxation",l=i<=e.props.alpha_level?"significant":"not significant",c=e.p_value_format(i),m=e.fit_format(t["relaxation-test"].LR),d=e.fit_format(t.fits.Alternative.K),u="PubMed ID "+r,p="http://www.ncbi.nlm.nih.gov/pubmed/"+r;e.setState({annotations:n,json:a,pmid:r,test_results:s,p:i,direction:o,evidence:l,pvalue:c,lrt:m,summary_k:d,pmid_text:u,pmid_href:p})})},getDefaultProps:function(){var e=function(e,n){var r=this,s=.33,i=t.format(".3r"),o=t.scale.pow().exponent(s).domain([0,.25,1,5,10]).range(r.options()["color-fill"]?["#DDDDDD","#AAAAAA","#888888","#444444","#000000"]:["#6e4fa2","#3288bd","#e6f598","#f46d43","#9e0142"]).clamp(!0);n.target.annotations?(e.style("stroke",o(n.target.annotations.length)||null),a(e[0][0]).tooltip("destroy"),a(e[0][0]).tooltip({title:i(n.target.annotations.length),html:!0,trigger:"hover",container:"body",placement:"auto"})):(e.style("stroke",null),a(e[0][0]).tooltip("destroy"));var l=a("#hyphy-tree-highlight").attr("value");if(l&&this.get_partitions()){var c=this.get_partitions()[l];e.style("stroke-width",c&&c[n.target.name]?"8":"4").style("stroke-linejoin","round").style("stroke-linecap","round")}};return{edgeColorizer:e,alpha_level:.05}},getInitialState:function(){var e={omegaPlot:{},"tree-options":{"hyphy-tree-model":["Partitioned MG94xREV",!0],"hyphy-tree-highlight":["RELAX.test",!1],"hyphy-tree-branch-lengths":[!0,!0],"hyphy-tree-hide-legend":[!0,!1],"hyphy-tree-fill-color":[!0,!1]},"suppress-tree-render":!1,"chart-append-html":!0,edgeColorizer:this.props.edgeColorizer};return{annotations:null,json:null,pmid:null,settings:e,test_results:null,tree:null,p:null,direction:"unknown",evidence:"unknown",pvalue:null,lrt:null,summary_k:"unknown",pmid_text:"PubMed ID : Unknown",pmid_href:"#",relaxation_K:"unknown"}},componentWillMount:function(){this.loadFromServer(),this.setEvents()},setEvents:function(){var e=this;a("#datamonkey-relax-load-json").on("change",function(t){var n=t.target.files;if(1==n.length){var r=n[0],s=new FileReader;s.onload=function(t){return function(t){var n=JSON.parse(this.result);n.fits["Partitioned MG94xREV"]["branch-annotations"]=e.formatBranchAnnotations(n,"Partitioned MG94xREV"),n.fits["General Descriptive"]["branch-annotations"]=e.formatBranchAnnotations(n,"General Descriptive"),n.fits.Null["branch-annotations"]=e.formatBranchAnnotations(n,"Null"),n.fits.Alternative["branch-annotations"]=e.formatBranchAnnotations(n,"Alternative"),n.fits["Partitioned Exploratory"]["branch-annotations"]=e.formatBranchAnnotations(n,"Partitioned Exploratory");var a=n.fits["Partitioned MG94xREV"]["branch-annotations"],r=n,s=n.PMID,i=n.relaxation_test,o=n["relaxation-test"].p,l=n.fits.Alternative.K>1?"intensification":"relaxation",c=o<=e.props.alpha_level?"significant":"not significant",m=e.p_value_format(o),d=e.fit_format(n["relaxation-test"].LR),u=e.fit_format(n.fits.Alternative.K),p="PubMed ID "+s,h="http://www.ncbi.nlm.nih.gov/pubmed/"+s;e.setState({annotations:a,json:r,pmid:s,test_results:i,p:o,direction:l,evidence:c,pvalue:m,lrt:d,summary_k:u,pmid_text:p,pmid_href:h})}}(r),s.readAsText(r)}a("#datamonkey-absrel-toggle-here").dropdown("toggle"),t.preventDefault()})},formatBranchAnnotations:function(e,t){var n=e.fits[t]["branch-annotations"];n||(n=e.fits[t]["rate distributions"]);var a=c.mapObject(n,function(e,t){return{length:e}});return a},initialize:function(){},render:function(){var e=this;return l.createElement("div",{className:"tab-content"},l.createElement("div",{className:"tab-pane active",id:"datamonkey-relax-summary-tab"},l.createElement("div",{id:"hyphy-relax-summary",className:"row"},l.createElement("div",{className:"col-md-12"},l.createElement("ul",{className:"list-group"},l.createElement("li",{className:"list-group-item list-group-item-info"},l.createElement("h3",{className:"list-group-item-heading"},l.createElement("i",{className:"fa fa-list",styleFormat:"margin-right: 10px"}),l.createElement("span",{id:"summary-method-name"},"RELAX(ed selection test)")," summary"),l.createElement("p",{className:"list-group-item-text lead",styleFormat:"margin-top:0.5em; "},"Test for selection ",l.createElement("strong",{id:"summary-direction"},this.state.direction),"(",l.createElement("abbr",{title:"Relaxation coefficient"},"K")," = ",l.createElement("strong",{id:"summary-K"},this.state.summary_k),") was ",l.createElement("strong",{id:"summary-evidence"},this.state.evidence),"(p = ",l.createElement("strong",{id:"summary-pvalue"},this.state.p),", ",l.createElement("abbr",{title:"Likelihood ratio statistic"},"LR")," = ",l.createElement("strong",{id:"summary-LRT"},this.state.lrt),")"),l.createElement("p",null,l.createElement("small",null,"Please cite ",l.createElement("a",{href:this.state.pmid_href,id:"summary-pmid"},this.state.pmid_text)," if you use this result in a publication, presentation, or other scientific work.")))))),l.createElement("div",{id:"hyphy-model-fits",className:"row"},l.createElement(s.ModelFits,{json:e.state.json})),l.createElement("div",{id:"hyphy-omega-plots",className:"row"},l.createElement(o.OmegaPlotGrid,{json:e.state.json}))),l.createElement("div",{className:"tab-pane",id:"tree-tab"},l.createElement(i.Tree,{json:e.state.json,settings:e.state.settings})))}});e.exports=r}).call(t,n(40),n(2))},222:function(e,t,n){(function(t){"use strict";var a=n(46),r=n(39),s=n(43),i=a.createClass({displayName:"OmegaPlot",getDefaultProps:function(){return{svg_id:null,dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:35,top:35},has_zeros:!1,legend_id:null,do_log_plot:!0,k_p:null,plot:null}},setEvents:function(){var e=this;t.select("#"+this.save_svg_id).on("click",function(t){r.save_image("svg","#"+e.svg_id)}),t.select("#"+this.save_png_id).on("click",function(t){r.save_image("png","#"+e.svg_id)})},initialize:function(){if(this.state.omegas&&this.state.omegas.Reference){var e=this.state.omegas.Reference,n=this.state.omegas.Test;this.svg_id=this.props.settings.svg_id,this.dimensions=this.props.settings.dimensions||this.props.dimensions,this.legend_id=this.props.settings.legend||this.props.legend_id,this.do_log_plot=this.props.settings.log||this.props.do_log_plot,this.k_p=this.props.settings.k||this.props.k_p;var a=this.props.dimensions,r=this.props.margins;this.margins=r,this.do_log_plot&&(this.has_zeros=e.some(function(e){return e.omega<=0}),n&&(this.has_zeros=this.has_zeros||e.some(function(e){return e.omega<=0}))),this.plot_width=a.width-r.left-r.right,this.plot_height=a.height-r.top-r.bottom;var s=this.state.settings.domain||t.extent(n?n.map(function(e){return e.omega}).concat(e.map(function(e){return e.omega})):e.map(function(e){return e.omega}));s[0]*=.5,this.omega_scale=(this.do_log_plot?this.has_zeros?t.scale.pow().exponent(.2):t.scale.log():t.scale.linear()).range([0,this.plot_width]).domain(s).nice(),this.proportion_scale=t.scale.linear().range([this.plot_height,0]).domain([-.05,1]).clamp(!0),this.svg=t.select("#"+this.svg_id).attr("width",a.width).attr("height",a.height),this.plot=this.svg.selectAll(".container"),this.svg.selectAll("defs").remove(),this.svg.append("defs").append("marker").attr("id","arrowhead").attr("refX",10).attr("refY",4).attr("markerWidth",10).attr("markerHeight",8).attr("orient","auto").attr("stroke","#000").attr("fill","#000").append("path").attr("d","M 0,0 V8 L10,4 Z"),this.plot.empty()&&(this.plot=this.svg.append("g").attr("class","container")),this.plot.attr("transform","translate("+this.margins.left+" , "+this.margins.top+")"),this.reference_omega_lines=this.plot.selectAll(".hyphy-omega-line-reference"),this.displacement_lines=this.plot.selectAll(".hyphy-displacement-line"),this.createDisplacementLine(),this.createNeutralLine(),this.createOmegaLine(),this.createReferenceLine(),this.createXAxis(),this.createYAxis(),this.setEvents()}},makeSpring:function(e,n,a,r,s,i){if(e==n)return a=Math.min(a,r),"M"+e+","+(a-40)+"v20";var o=[],l=[e,a],c=Math.atan2(r-a,n-e),s=[s*Math.cos(c),s*Math.sin(c)],m=0;if(Math.abs(e-n)<15)o.push(l);else for(;(e<n&&l[0]<n-15||e>n&&l[0]>n+15)&&(l=l.map(function(e,t){return e+s[t]}),m%2?o.push([l[0],l[1]+i]):o.push([l[0],l[1]-i]),m++,!(m>100)););o.length>1&&o.pop(),o.push([n,r]);var d=t.svg.line().interpolate("monotone");return d(o)},createDisplacementLine:function(){var e=this,t=this.state.omegas.Reference,n=this.state.omegas.Test;if(n){var a=t.map(function(e,t){return{x1:e.omega,x2:n[t].omega,y1:.98*e.weight,y2:.98*n[t].weight}});this.displacement_lines=this.displacement_lines.data(a),this.displacement_lines.enter().append("path"),this.displacement_lines.exit().remove(),this.displacement_lines.transition().attr("d",function(t){return e.makeSpring(e.omega_scale(t.x1),e.omega_scale(t.x2),e.proportion_scale(.5*t.y1),e.proportion_scale(.5*t.y2),5,5)}).attr("marker-end","url(#arrowhead)").attr("class","hyphy-displacement-line")}},createReferenceLine:function(){var e=this.state.omegas.Reference,t=this.state.omegas.Test,n=this;t?(this.reference_omega_lines=this.reference_omega_lines.data(e),this.reference_omega_lines.enter().append("line"),this.reference_omega_lines.exit().remove(),this.reference_omega_lines.transition().attr("x1",function(e){return n.omega_scale(e.omega)}).attr("x2",function(e){return n.omega_scale(e.omega)}).attr("y1",function(e){return n.proportion_scale(-.05)}).attr("y2",function(e){return n.proportion_scale(e.weight)}).style("stroke",function(e){return"#d62728"}).attr("class","hyphy-omega-line-reference")):(this.reference_omega_lines.remove(),this.displacement_lines.remove())},createOmegaLine:function(){var e=this.state.omegas.Reference,t=this.state.omegas.Test,n=this,a=this.plot.selectAll(".hyphy-omega-line").data(t?t:e);a.enter().append("line"),a.exit().remove(),a.transition().attr("x1",function(e){return n.omega_scale(e.omega)}).attr("x2",function(e){return n.omega_scale(e.omega)}).attr("y1",function(e){return n.proportion_scale(-.05)}).attr("y2",function(e){return n.proportion_scale(e.weight)}).style("stroke",function(e){return"#1f77b4"}).attr("class","hyphy-omega-line")},createNeutralLine:function(){var e=this,t=this.plot.selectAll(".hyphy-neutral-line").data([1]);t.enter().append("line").attr("class","hyphy-neutral-line"),t.exit().remove(),t.transition().attr("x1",function(t){return e.omega_scale(t)}).attr("x2",function(t){return e.omega_scale(t)}).attr("y1",0).attr("y2",this.plot_height)},createXAxis:function(){var e=t.svg.axis().scale(this.omega_scale).orient("bottom");this.do_log_plot&&e.ticks(10,this.has_zeros?".2r":".1r");var n,a=this.svg.selectAll(".x.axis");a.empty()?(a=this.svg.append("g").attr("class","x hyphy-axis"),n=a.append("g").attr("class","hyphy-axis-label x-label")):n=a.select(".axis-label.x-label"),a.attr("transform","translate("+this.margins.left+","+(this.plot_height+this.margins.top)+")").call(e),n=n.attr("transform","translate("+this.plot_width+","+this.margins.bottom+")").selectAll("text").data(["ω"]),n.enter().append("text"),n.text(function(e){return e}).style("text-anchor","end").attr("dy","0.0em")},createYAxis:function(){var e,n=t.svg.axis().scale(this.proportion_scale).orient("left").ticks(10,".1p"),a=this.svg.selectAll(".y.hyphy-axis");a.empty()?(a=this.svg.append("g").attr("class","y hyphy-axis"),e=a.append("g").attr("class","hyphy-axis-label y-label")):e=a.select(".hyphy-axis-label.y-label"),a.attr("transform","translate("+this.margins.left+","+this.margins.top+")").call(n),e=e.attr("transform","translate("+-this.margins.left+",0)").selectAll("text").data(["Proportion of sites"]),e.enter().append("text"),e.text(function(e){return e}).style("text-anchor","start").attr("dy","-1em")},getInitialState:function(){return{omegas:this.props.omegas,settings:this.props.settings}},componentWillReceiveProps:function(e){this.setState({omegas:e.omegas})},componentDidUpdate:function(){this.initialize()},componentDidMount:function(){this.initialize()},render:function(){var e=this.props.omegas.key,t=this.props.omegas.label;return this.svg_id=e+"-svg",this.save_svg_id="export-"+e+"-svg",this.save_png_id="export-"+e+"-png",a.createElement("div",{className:"col-lg-6"},a.createElement("div",{className:"panel panel-default",id:e},a.createElement("div",{className:"panel-heading"},a.createElement("h3",{className:"panel-title"},"ω distributions under the ",a.createElement("strong",null,t)," model"),a.createElement("p",null,a.createElement("small",null,"Test branches are shown in ",a.createElement("span",{className:"hyphy-blue"},"blue")," and reference branches are shown in ",a.createElement("span",{className:"hyphy-red"},"red"))),a.createElement("div",{className:"btn-group"},a.createElement("button",{id:this.save_svg_id,type:"button",className:"btn btn-default btn-sm"},a.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," SVG"),a.createElement("button",{id:this.save_png_id,type:"button",className:"btn btn-default btn-sm"},a.createElement("span",{className:"glyphicon glyphicon-floppy-save"})," PNG"))),a.createElement("div",{className:"panel-body"},a.createElement("svg",{id:this.svg_id}))))}}),o=a.createClass({displayName:"OmegaPlotGrid",getInitialState:function(){return{omega_distributions:this.getDistributions(this.props.json)}},componentWillReceiveProps:function(e){this.setState({omega_distributions:this.getDistributions(e.json)})},getDistributions:function(e){var t={};if(!e)return[];for(var n in e.fits){var a=e.fits[n];t[n]={};for(var r in a["rate-distributions"]){var i=a["rate-distributions"][r];t[n][r]=i.map(function(e){return{omega:e[0],weight:e[1]}})}}s.each(t,function(e,t){e.key=t.toLowerCase().replace(/ /g,"-"),e.label=t});var t=s.filter(t,function(e){return s.isObject(e.Reference)});return t},render:function(){var e=s.map(this.state.omega_distributions,function(e,t){var n=t,r=e,s={svg_id:r.key+"-svg",dimensions:{width:600,height:400},margins:{left:50,right:15,bottom:35,top:35},has_zeros:!1,legend_id:null,do_log_plot:!0,k_p:null,plot:null};return a.createElement(i,{name:n,omegas:r,settings:s})});return a.createElement("div",null,e)}});e.exports.OmegaPlot=i,e.exports.OmegaPlotGrid=o}).call(t,n(40))},223:function(e,t,n){(function(t,a){"use strict";function r(e,t){c.render(l.createElement(u,{url:e}),document.getElementById(t))}var s=n(224),i=n(225),o=n(226),l=n(46),c=n(!function(){var e=new Error('Cannot find module "react-dom"');throw e.code="MODULE_NOT_FOUND",e}()),m=n(43),d=n(39);n(227);var u=l.createClass({displayName:"SLAC",float_format:t.format(".2f"),dm_loadFromServer:function(){var e=this;t.json(e.props.url,function(t,n){if(n)e.dm_initializeFromJSON(n);else{var a=404==t.status?e.props.url+" could not be loaded":t.statusText;e.setState({error_message:a})}})},dm_initializeFromJSON:function(e){this.setState({analysis_results:e})},getDefaultProps:function(){return{url:"#"}},getInitialState:function(){return{analysis_results:null,error_message:null,pValue:.1}},componentWillMount:function(){this.dm_loadFromServer(),this.dm_setEvents()},dm_setEvents:function(){var e=this;a("#datamonkey-json-file").on("change",function(t){var n=t.target.files;if(1==n.length){var r=n[0],s=new FileReader;s.onload=function(t){return function(t){try{e.dm_initializeFromJSON(JSON.parse(this.result))}catch(t){e.setState({error_message:t.toString()})}}}(r),s.readAsText(r)}a("#datamonkey-json-file-toggle").dropdown("toggle")})},dm_adjustPvalue:function(e){this.setState({pValue:parseFloat(e.target.value)})},render:function(){var e=this;return e.state.error_message?l.createElement("div",{id:"datamonkey-error",className:"alert alert-danger alert-dismissible",role:"alert"},l.createElement("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close"},l.createElement("span",{"aria-hidden":"true"},"×")),l.createElement("strong",null,e.state.error_message)," ",l.createElement("span",{id:"datamonkey-error-text"})):e.state.analysis_results?l.createElement("div",{className:"tab-content"},l.createElement("div",{className:"tab-pane",id:"summary_tab"},l.createElement("div",{className:"row"},l.createElement("div",{id:"summary-div",className:"col-md-12"},l.createElement(o.SLACBanner,{analysis_results:e.state.analysis_results,pValue:e.state.pValue,pAdjuster:m.bind(e.dm_adjustPvalue,e)}))),l.createElement("div",{className:"row hidden-print"},l.createElement("div",{id:"datamonkey-slac-tree-summary",className:"col-lg-4 col-md-6 col-sm-12"},l.createElement("div",{className:"panel panel-default"},l.createElement("div",{className:"panel-heading"},l.createElement("h3",{className:"panel-title"},l.createElement("i",{className:"fa fa-puzzle-piece"})," Partition information")),l.createElement("div",{className:"panel-body"},l.createElement("small",null,l.createElement(s.DatamonkeyPartitionTable,{pValue:e.state.pValue,trees:e.state.analysis_results.trees,partitions:e.state.analysis_results.partitions,branchAttributes:e.state.analysis_results["branch attributes"],siteResults:e.state.analysis_results.MLE,accessorPositive:function(e,t){return m.map(e.content[t]["by-site"].AVERAGED,function(e){return e[8]})},accessorNegative:function(e,t){return m.map(e.content[t]["by-site"].AVERAGED,function(e){return e[9]})}}))))),l.createElement("div",{id:"datamonkey-slac-model-fits",className:"col-lg-5 col-md-6 col-sm-12"},l.createElement("div",{className:"panel panel-default"},l.createElement("div",{className:"panel-heading"},l.createElement("h3",{className:"panel-title"},l.createElement("i",{className:"fa fa-table"})," Model fits")),l.createElement("div",{className:"panel-body"},l.createElement("small",null,l.createElement(s.DatamonkeyModelTable,{fits:e.state.analysis_results.fits}))))),l.createElement("div",{id:"datamonkey-slac-timers",className:"col-lg-3 col-md-3 col-sm-12"},l.createElement("div",{className:"panel panel-default"},l.createElement("div",{className:"panel-heading"},l.createElement("h3",{className:"panel-title"},l.createElement("i",{className:"fa fa-clock-o"})," Execution time")),l.createElement("div",{className:"panel-body"},l.createElement("small",null,l.createElement(s.DatamonkeyTimersTable,{timers:e.state.analysis_results.timers,totalTime:"Total time"}))))))),l.createElement("div",{className:"tab-pane active",id:"sites_tab"},l.createElement("div",{className:"row"},l.createElement("div",{id:"summary-div",className:"col-md-12"},l.createElement(i.SLACSites,{headers:e.state.analysis_results.MLE.headers,mle:d.helpers.map(d.helpers.filter(e.state.analysis_results.MLE.content,function(e,t){return m.has(e,"by-site")}),function(e,t){return e["by-site"]}),sample25:e.state.analysis_results["sample-2.5"],sampleMedian:e.state.analysis_results["sample-median"],sample975:e.state.analysis_results["sample-97.5"],partitionSites:e.state.analysis_results.partitions})))),l.createElement("div",{className:"tab-pane",id:"tree_tab"})):null}});e.exports=r}).call(t,n(40),n(2))},224:function(e,t,n){(function(t,a){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n(46),i=n(39),o=s.createClass({displayName:"DatamonkeyTableRow",dm_compareTwoValues:function(e,n){var a="undefined"==typeof e?"undefined":r(e),s=this;if(a==("undefined"==typeof n?"undefined":r(n))){if("string"==a||"number"==a)return e==n?1:0;if(t.isArray(e)&&t.isArray(n)){if(e.length!=n.length)return 0;var i=0,o=t.every(e,function(e,t){var a=s.dm_compareTwoValues(e,n[t]);return a<0?(i=a,!1):1==a});return i<0?i:o?1:0}return-2}return-1},dm_log100times:t.before(100,function(e){return console.log(e),0}),shouldComponentUpdate:function(e){var n=this;if(this.props.header!==e.header)return!0;var a=t.some(this.props.rowData,function(a,r){if(a===e.rowData[r])return!1;var s=n.dm_compareTwoValues(a,e.rowData[r]);return s>=0?0==s:s!=-2||!t.has(a,"value")||!t.has(e.rowData[r],"value")||1!=n.dm_compareTwoValues(a.value,e.rowData[r].value)});return a&&this.dm_log100times(["Old",this.props.rowData,"New",e.rowData]),a},render:function(){return s.createElement("tr",null,this.props.rowData.map(t.bind(function(e,n){var a=t.has(e,"value")?e.value:e;if(t.isArray(a)){if(!t.has(e,"format"))return a}else if(t.isObject(a)&&!s.isValidElement(a))return null;t.has(e,"format")&&(a=e.format(a)),t.has(e,"abbr")&&(a=s.createElement("abbr",{title:e.abbr},a));var r={key:n};return t.has(e,"span")&&(r.colSpan=e.span),t.has(e,"style")&&(r.style=e.style),t.has(e,"classes")&&(r.className=e.classes),s.createElement(this.props.header?"th":"td",r,a)},this)))}}),l=s.createClass({displayName:"DatamonkeyTable",getDefaultProps:function(){return{classes:"table table-condensed table-hover",rowHash:null,sortableColumns:new Object(null),initialSort:null}},getInitialState:function(){return{sortedOn:this.props.initialSort}},render:function(){var e=[];return this.props.headerData&&(t.isArray(this.props.headerData[0])?e.push(s.createElement("thead",{key:0},t.map(this.props.headerData,function(e,t){return s.createElement(o,{rowData:e,header:!0,key:t})}))):e.push(s.createElement("thead",{key:0},s.createElement(o,{rowData:this.props.headerData,header:!0})))),e.push(s.createElement("tbody",{key:1},t.map(this.props.bodyData,t.bind(function(e,t){return s.createElement(o,{rowData:e,key:this.props.rowHash?this.props.rowHash(e):t,header:!1})},this)))),s.createElement("table",{className:this.props.classes},e)}}),c=s.createClass({displayName:"DatamonkeyRateDistributionTable",propTypes:{distribution:s.PropTypes.object.isRequired},dm_formatterRate:a.format(".3r"),dm_formatterProp:a.format(".3p"),dm_createDistributionTable:function(e){var n=[],a=this;return t.each(e,function(e,r){n.push([{value:r,span:3,classes:"info"}]),t.each(e,function(e,t){n.push([{value:e[1],format:a.dm_formatterProp},"@",{value:e[0],format:a.dm_formatterRate}])})}),n},render:function(){return s.createElement(l,{bodyData:this.dm_createDistributionTable(this.props.distribution),classes:"table table-condensed"})}}),m=s.createClass({displayName:"DatamonkeyPartitionTable",dm_formatterFloat:a.format(".3r"),dm_formatterProp:a.format(".3p"),propTypes:{trees:s.PropTypes.object.isRequired,partitions:s.PropTypes.object.isRequired,branchAttributes:s.PropTypes.object.isRequired,siteResults:s.PropTypes.object.isRequired,accessorNegative:s.PropTypes.func.isRequired,accessorPositive:s.PropTypes.func.isRequired,pValue:s.PropTypes.number.isRequired},dm_computePartitionInformation:function(e,n,a,r){var s=t.sortBy(t.keys(n),function(e){return e}),o=null,l=this,c=this.props.extractOn||t.find(a.attributes,function(e,t){return o=t,"branch length"==e["attribute type"]});return o&&(c=o),t.map(s,function(s,o){var m=e.tested[s],d={};t.each(m,function(e,t){"test"==e&&(d[t]=1)});var u=c?i.helpers.sum(a[s],function(e,t){return d[t.toUpperCase()]?e[c]:0}):0,p=c?i.helpers.sum(a[s],function(e){return e[c]||0}):0;return t.map([o+1,n[s].coverage[0].length,t.size(d),t.keys(m).length,u,u/p,p,t.filter(l.props.accessorPositive(l.props.siteResults,s),function(e){return e<=r}).length,t.filter(l.props.accessorNegative(l.props.siteResults,s),function(e){return e<=r}).length],function(e,n){if(n>1){var a={value:e,style:{textAlign:"center"}};return 4!=n&&6!=n||t.extend(a,{format:l.dm_formatterFloat}),5==n&&t.extend(a,{format:l.dm_formatterProp}),a}return e})})},dm_makeHeaderRow:function(e){return[t.map(["Partition","Sites","Branches","Branch Length","Selected at p"+String.fromCharCode(parseInt("2264",16))+e],function(e,n){return t.extend({value:e,style:{borderBottom:0,textAlign:n>1?"center":"left"}},n>1?{span:3==n?3:2}:{})}),t.map(["","","Tested","Total","Tested","% of total","Total","Positive","Negative"],function(e,t){return{value:e,style:{borderTop:0,textAlign:t>1?"center":"left"}}})]},getInitialState:function(){return{header:this.dm_makeHeaderRow(this.props.pValue),rows:this.dm_computePartitionInformation(this.props.trees,this.props.partitions,this.props.branchAttributes,this.props.pValue)}},componentWillReceiveProps:function(e){this.setState({header:this.dm_makeHeaderRow(e.pValue),rows:this.dm_computePartitionInformation(e.trees,e.partitions,e.branchAttributes,e.pValue)})},render:function(){return s.createElement("div",{className:"table-responsive"},s.createElement(l,{headerData:this.state.header,bodyData:this.state.rows}))}}),d=s.createClass({displayName:"DatamonkeyModelTable",dm_numberFormatter:a.format(".2f"),dm_supportedColumns:{"log likelihood":{order:2,value:{value:"log L",abbr:"log likelihood"},display_format:a.format(".2f")},parameters:{order:3,value:"Parameters"},"AIC-c":{order:1,value:{value:s.createElement("span",null,["AIC",s.createElement("sub",{key:"0"},"C")]),abbr:"Small-sample corrected Akaike Information Score"},display_format:a.format(".2f")},"rate distributions":{order:4,value:"Rate distributions",transform:function(e){return s.createElement(c,{distribution:e})}}},propTypes:{fits:s.PropTypes.object.isRequired},getDefaultProps:function(){return{orderOn:"display order"}},dm_extractFitsTable:function(e){var n=null,a=[],r={},s={},i=[],o=this;return t.each(e,function(e,l){n||(n={},t.each(e,function(e,i){o.dm_supportedColumns[i]&&(n[i]=o.dm_supportedColumns[i],a[n[i].order]=i,r[i]=o.dm_supportedColumns[i].display_format,t.isFunction(o.dm_supportedColumns[i].transform)&&(s[i]=o.dm_supportedColumns[i].transform))}),a=t.filter(a,function(e){return e}));var c=[{value:l,style:{fontVariant:"small-caps"}}];t.each(a,function(t){var n=s[t]?s[t](e[t]):e[t];r[t]?c.push({value:n,format:r[t]}):c.push(n)}),i.push([c,t.isNumber(e[o.props.orderOn])?e[o.props.orderOn]:i.length])}),{data:t.map(t.sortBy(i,function(e){return e[1]}),function(e){return e[0]}),columns:t.map(a,function(e){return n[e].value})}},dm_makeHeaderRow:function(e){var n=["Model"];return t.each(e,function(e){n.push(e)}),n},getInitialState:function(){var e=this.dm_extractFitsTable(this.props.fits);return{header:this.dm_makeHeaderRow(e.columns),rows:e.data,caption:null}},render:function(){return s.createElement("div",{className:"table-responsive"},s.createElement(l,{headerData:this.state.header,bodyData:this.state.rows}))}}),u=s.createClass({displayName:"DatamonkeyTimersTable",dm_percentageFormatter:a.format(".2%"),propTypes:{timers:s.PropTypes.object.isRequired},dm_formatSeconds:function(e){var n=[~~(e/3600),~~(e%3600/60),e%60];return t.map(n,function(e){return e<10?"0"+e:""+e}).join(":")},dm_extractTimerTable:function(e){var n=0,a=t.map(e,t.bind(function(e,t){return this.props.totalTime?t==this.props.totalTime&&(n=e.timer):n+=e.timer,[t,e.timer,e.order]},this));return a=t.sortBy(a,function(e){return e[2]}),a=t.map(a,t.bind(function(e){return null===this.props.totalTime||this.props.totalTime!=e[0]?e[2]={value:e[1]/n,format:this.dm_percentageFormatter}:e[2]="",e[1]=this.dm_formatSeconds(e[1]),e},this))},dm_makeHeaderRow:function(){return["Task","Time","%"]},getInitialState:function(){return{header:this.dm_makeHeaderRow(),rows:this.dm_extractTimerTable(this.props.timers),caption:null}},render:function(){return s.createElement(l,{headerData:this.state.header,bodyData:this.state.rows})}});e.exports.DatamonkeyTable=l,e.exports.DatamonkeyTableRow=o,e.exports.DatamonkeyRateDistributionTable=c,e.exports.DatamonkeyPartitionTable=m,e.exports.DatamonkeyModelTable=d,e.exports.DatamonkeyTimersTable=u}).call(t,n(43),n(40))},225:function(e,t,n){(function(t,a){"use strict";var r=n(224),s=n(46),i=n(39),o=s.createClass({displayName:"SLACSites",propTypes:{headers:s.PropTypes.arrayOf(s.PropTypes.arrayOf(s.PropTypes.string)).isRequired,mle:s.PropTypes.object.isRequired,sample25:s.PropTypes.object,sampleMedian:s.PropTypes.object,sample975:s.PropTypes.object,initialAmbigHandling:s.PropTypes.string.isRequired,partitionSites:s.PropTypes.object.isRequired},getInitialState:function(){var e=this.props.sample25&&this.props.sampleMedian&&this.props.sample975;return{ambigOptions:this.dm_AmbigOptions(this.props),ambigHandling:this.props.initialAmbigHandling,filters:new Object(null),showIntervals:e,hasCI:e}},getDefaultProps:function(){return{sample25:null,sampleMedian:null,sample975:null,initialAmbigHandling:"RESOLVED"}},componentWillReceiveProps:function(e){this.setState({ambigOptions:this.dm_AmbigOptions(e),ambigHandling:e.initialAmbigHandling})},dm_formatNumber:t.format(".3r"),dm_formatNumberShort:t.format(".2r"),dm_log10times:a.before(10,function(e){return console.log(e),
0}),dm_formatInterval:function(e){return this.dm_formatNumber(e[0])+" / "+this.dm_formatNumber(e[2])+" ["+this.dm_formatNumber(e[1])+" : "+this.dm_formatNumber(e[3])+"]"},dm_AmbigOptions:function(e){return a.keys(e.mle[0])},dm_changeAmbig:function(e){this.setState({ambigHandling:e.target.value})},dm_toggleIntervals:function(e){this.setState({showIntervals:!this.state.showIntervals})},dm_toggleVariableFilter:function(e){var t=new Object(null);a.extend(t,this.state.filters),t.variable="on"==this.state.filters.variable?"off":"on",this.setState({filters:t})},dm_makeFilterFunction:function(){var e=null;return a.each(this.state.filters,function(t,n){var r=null;switch(n){case"variable":"on"==t&&(r=function(e,t,n,a,r){return(!e||e(t,n,a,r))&&r[2]+r[3]>0})}r&&(e=a.wrap(e,r))}),e},dm_makeHeaderRow:function(){var e=["Partition","Site"],t=this.state.showIntervals;if(t){var n=["",""];return a.each(this.props.headers,function(t){e.push({value:t[0],abbr:t[1],span:4,style:{textAlign:"center"}}),n.push("MLE"),n.push("Med"),n.push("2.5%"),n.push("97.5%")}),[e,n]}return a.each(this.props.headers,function(t){e.push({value:t[0],abbr:t[1]})}),e},dm_makeDataRows:function(e){for(var t=[],n=i.helpers.countPartitionsJSON(this.props.partitionSites),r=0,s=this,o=this.state.showIntervals;r<n;)a.each(s.props.partitionSites[r].coverage[0],function(n,i){var l=s.props.mle[r][s.state.ambigHandling][i];if(!e||e(r,i,n,l)){var c=[r+1,n+1];a.each(l,function(e,t){o?(c.push({value:e,format:s.dm_formatNumber}),c.push({value:s.props.sample25[r][s.state.ambigHandling][i][t],format:s.dm_formatNumberShort}),c.push({value:s.props.sampleMedian[r][s.state.ambigHandling][i][t],format:s.dm_formatNumberShort}),c.push({value:s.props.sample975[r][s.state.ambigHandling][i][t],format:s.dm_formatNumberShort})):c.push({value:e,format:s.dm_formatNumber})}),t.push(c)}}),r++;return t},render:function(){var e=this,t=s.createElement("div",{className:"table-responsive"},s.createElement("form",{className:"form-inline navbar-form navbar-left"},s.createElement("div",{className:"form-group"},s.createElement("div",{className:"btn-group"},s.createElement("button",{className:"btn btn-default btn-sm dropdown-toggle",type:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"Display Options ",s.createElement("span",{className:"caret"})),s.createElement("ul",{className:"dropdown-menu"},s.createElement("li",{key:"variable"},s.createElement("div",{className:"checkbox"},s.createElement("input",{type:"checkbox",checked:"on"==e.state.filters.variable,defaultChecked:"on"==e.state.filters.variable,onChange:e.dm_toggleVariableFilter})," Variable sites only")),e.state.hasCI?s.createElement("li",{key:"intervals"},s.createElement("div",{className:"checkbox"},s.createElement("input",{type:"checkbox",checked:e.state.showIntervals,defaultChecked:e.state.showIntervals,onChange:e.dm_toggleIntervals})," Show sampling confidence intervals")):null)),s.createElement("div",{className:"input-group"},s.createElement("div",{className:"input-group-addon"},"Ambiguities are "),s.createElement("select",{className:"form-control input-sm",defaultValue:e.state.ambigHandling,onChange:e.dm_changeAmbig},a.map(this.state.ambigOptions,function(e,t){return s.createElement("option",{key:t,value:e},e)}))))),s.createElement(r.DatamonkeyTable,{headerData:this.dm_makeHeaderRow(),bodyData:this.dm_makeDataRows(this.dm_makeFilterFunction())}));return t}});e.exports.SLACSites=o}).call(t,n(40),n(43))},226:function(e,t,n){(function(t,a){"use strict";var r=n(46),s=n(39),i=r.createClass({displayName:"SLACBanner",dm_countSites:function(e,n){var a={all:0,positive:0,negative:0};return a.all=s.helpers.countSitesFromPartitionsJSON(e),a.positive=s.helpers.sum(e.MLE.content,function(e){return t.reduce(e["by-site"].RESOLVED,function(e,t){return e+(t[8]<=n?1:0)},0)}),a.negative=s.helpers.sum(e.MLE.content,function(e){return t.reduce(e["by-site"].RESOLVED,function(e,t){return e+(t[9]<=n?1:0)},0)}),a},dm_computeState:function(e,t){return{sites:this.dm_countSites(e,t)}},dm_formatP:a.format(".3f"),getInitialState:function(){return this.dm_computeState(this.props.analysis_results,this.props.pValue)},componentWillReceiveProps:function(e){this.setState(this.dm_computeState(e.analysis_results,e.pValue))},render:function(){return r.createElement("div",{className:"panel panel-primary"},r.createElement("div",{className:"panel-heading"},r.createElement("h3",{className:"panel-title"},r.createElement("abbr",{title:"Single Likelihood Ancestor Counting"},"SLAC")," analysis summary")),r.createElement("div",{className:"panel-body"},r.createElement("span",{className:"lead"},"Evidence",r.createElement("sup",null,"†")," of pervasive ",r.createElement("span",{className:"hyphy-red"},"diversifying")," / ",r.createElement("span",{className:"hyphy-navy"},"purifying")," selection was found at",r.createElement("strong",{className:"hyphy-red"}," ",this.state.sites.positive)," / ",r.createElement("strong",{className:"hyphy-navy"},this.state.sites.negative)," sites among ",this.state.sites.all," tested sites"),r.createElement("div",{style:{marginBottom:"0em"}},r.createElement("small",null,r.createElement("sup",null,"†"),"Extended binomial test, p ≤ ",this.dm_formatP(this.props.pValue),r.createElement("div",{className:"dropdown hidden-print",style:{display:"inline",marginLeft:"0.25em"}},r.createElement("button",{id:"dm.pvalue.slider",type:"button",className:"btn btn-primary btn-xs dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},r.createElement("span",{className:"caret"})),r.createElement("ul",{className:"dropdown-menu","aria-labelledby":"dm.pvalue.slider"},r.createElement("li",null,r.createElement("a",{href:"#"},r.createElement("input",{type:"range",min:"0",max:"1",value:this.props.pValue,step:"0.01",onChange:this.props.pAdjuster}))))),r.createElement("emph",null," not")," corrected for multiple testing; ambiguous characters resolved to minimize substitution counts.",r.createElement("br",null),r.createElement("i",{className:"fa fa-exclamation-circle"})," Please cite ",r.createElement("a",{href:"http://www.ncbi.nlm.nih.gov/pubmed/15703242",target:"_blank"},"PMID 15703242")," if you use this result in a publication, presentation, or other scientific work."))))}});e.exports.SLACBanner=i}).call(t,n(43),n(40))},227:function(e,t,n){(function(e,t,a,r){"use strict";function s(e){function t(e){if(e.cssRules)for(var a=0;a<e.cssRules.length;a++){var r=e.cssRules[a];3===r.type?t(r.styleSheet):r.selectorText&&r.selectorText.indexOf(">")===-1&&(n+="\n"+r.cssText)}}var n="",a=e.styleSheets;if(a)for(var r=0;r<a.length;r++)t(a[r]);return n}function i(){var t="#neighbor-tree-modal",n=e(t).data("tree"),a=document.createElement("a");a.setAttribute("href","data:text/octet-stream;charset=utf-8,"+encodeURIComponent(n)),a.setAttribute("download","nwk.txt"),e("body").append(a),a.click(),a.remove()}function o(t){var n=document.getElementById("image");n.src=t,n.onload=function(){var t=document.getElementById("canvas");t.width=n.width,t.height=n.height;var a=t.getContext("2d");a.fillStyle="#FFFFFF",a.fillRect(0,0,n.width,n.height),a.drawImage(n,0,0);var r=(t.toDataURL("image/png"),document.createElement("a"));r.setAttribute("download","phylotree.png"),r.href=t.toDataURL("image/png"),e("body").append(r),r.click(),r.remove()}}function l(t){var n={xmlns:"http://www.w3.org/2000/xmlns/",xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"},a=e("#tree_container").find("svg")[0],r=s(window.document);a.setAttribute("version","1.1");var i=document.createElement("defs");a.insertBefore(i,a.firstChild);var l=document.createElement("style");i.appendChild(l),l.setAttribute("type","text/css"),a.removeAttribute("xmlns"),a.removeAttribute("xlink"),a.hasAttributeNS(n.xmlns,"xmlns")||a.setAttributeNS(n.xmlns,"xmlns",n.svg),a.hasAttributeNS(n.xmlns,"xmlns:xlink")||a.setAttributeNS(n.xmlns,"xmlns:xlink",n.xlink);var c=(new XMLSerializer).serializeToString(a).replace("</style>","<![CDATA["+r+"]]></style>"),m=(a.getBoundingClientRect(),'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),d=[m+c],u="data:image/svg+xml;base66,"+encodeURIComponent(d);if("png"==t)o(u);else{var p=document.createElement("a");p.setAttribute("download","phylotree.svg"),p.setAttribute("href",u),e("body").append(p),p.click(),p.remove()}}function c(n){if(e(this).find("input[name='receive_mail']")[0].checked){var a=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(a.test(e(this).find("input[name='mail']").val()))e(this).removeClass("has-error"),e(this).addClass("has-success"),e(this).next(".help-block").remove();else{e(this).next(".help-block").remove(),e(this).removeClass("has-error"),e(this).removeClass("has-success"),e(this).addClass("has-error");t("<span/>",{class:"help-block col-lg-9 pull-right",text:"Invalid Email"}).insertAfter(e(this))}}else e(this).removeClass("has-error"),e(this).removeClass("has-success"),e(this).next(".help-block").remove()}function m(e,t){e.sort(a.ascending);var n={min:a.min(e),max:a.max(e),median:a.median(e),Q1:a.quantile(e,.25),Q3:a.quantile(e,.75),mean:a.mean(e)};return t&&(n="<pre>Range  :"+n.min+"-"+n.max+"\nIQR    :"+n.Q1+"-"+n.Q3+"\nMean   :"+n.mean+"\nMedian :"+n.median+"\n</pre>"),n}function d(e,t,n){var a=document.createElement("a");a.setAttribute("href","data:"+(n||"text/plain")+";charset=utf-8,"+encodeURIComponent(e)),a.setAttribute("download",t||"download.tsv"),a.click(),a.remove()}function u(e,t){t=t||"\t";var n=[];a.select(e+" thead").selectAll("th").each(function(){n.push(a.select(this).text())});var r=[];return a.select(e+" tbody").selectAll("tr").each(function(e,t){r.push([]),a.select(this).selectAll("td").each(function(){r[t].push(a.select(this).text())})}),n.join(t)+"\n"+r.map(function(e){return e.join(t)}).join("\n")}function p(e){return e.length>0?e[0].toUpperCase()+e.slice(1):e}function h(e){try{return r.keys(e).length}catch(e){}return 0}function f(e,t){return t=t||function(e){return e},r.reduce(e,function(e,n,a){return e+t(n,a)},0)}function g(e){try{return f(e.partitions,function(e){return e.coverage[0].length})}catch(e){}return 0}function v(e,t,n){var a={};return t=r.bind(t,n),r.each(e,r.bind(function(e,n){t(e,n)&&(a[n]=e)},n)),a}function b(e,t,n){var a={};return t=r.bind(t,n),r.each(e,r.bind(function(e,n){a[n]=t(e,n)},n)),a}var y=n(39);y.helpers=new Object,y.helpers.save_newick_to_file=i,y.helpers.convert_svg_to_png=o,y.helpers.save_newick_tree=l,y.helpers.validate_email=c,y.helpers.describe_vector=m,y.helpers.table_to_text=u,y.helpers.export_handler=d,y.helpers.capitalize=p,y.helpers.countPartitionsJSON=h,y.helpers.countSitesFromPartitionsJSON=g,y.helpers.sum=f,y.helpers.filter=v,y.helpers.map=b}).call(t,n(2),n(2),n(40),n(43))}});
//# sourceMappingURL=hyphyvision.min.js.map