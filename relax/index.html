<!DOCTYPE html>
<html lang='en'>

<head>

  <meta charset="utf-8">

  <link rel="stylesheet" href="../vendor/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="../vendor/bootstrap/dist/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="../vendor/font-awesome/css/font-awesome.css">
  <link rel="stylesheet" href="../vendor/phylotree/phylotree.css">
  <link href="../hyphy-vision.css" rel="stylesheet">

  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <script src="../vendor/jquery/dist/jquery.js"></script>
  <script src="../vendor/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="../vendor/underscore/underscore-min.js"></script>
  <script src="../vendor/d3/d3.min.js"></script>
  <script src="../vendor/phylotree/phylotree.js"></script>
  <script src="../vendor/react/react-with-addons.js"></script>

  <script src="../hyphy-vision.js"></script>
  <title> RELAX analysis result</title>

</head>

<body style='padding-top: 70px;'>

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">RELAX results</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse-1">

                <ul class="nav nav-pills navbar-right" role="tablist" id='navigation_buttons'>
                    <li class="active"><a href="#datamonkey-relax-summary-tab" role="tab" data-toggle="tab"><i class="fa fa-list" style = 'margin-right: 5px'></i>Summary</a></li>
                    <li><a href="#tree-tab" class="tree-tab-btn" role="tab" data-toggle="tab"><i class="fa fa-tree" style = 'margin-right: 5px'></i> Tree</a></li>
                </ul>

                <ul class="nav navbar-nav">
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Load file<b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <input type="file" id="datamonkey-relax-load-json">
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class='container-fluid'>

        <div id='datamonkey-relax-error' class="alert alert-danger alert-dismissible" role="alert" style="display:none;">
            <button type="button" class="close" id='datamonkey-relax-error-hide'><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <strong>Error!</strong> <span id='datamonkey-relax-error-text'></span>
        </div>

        <div class="tab-content">
           <div class="tab-pane active" id="datamonkey-relax-summary-tab">
               <div id="hyphy-relax-summary" class="row" style='margin-top: 5px'></div>
               <div id="hyphy-model-fits" class="row"></div>
               <div id="hyphy-omega-plots" class="row"></div>
           </div>
           <div class='tab-pane' id="tree-tab"></div>
        </div>
    </div>

    <img id="hyphy-chart-image" />
    <canvas id="hyphy-chart-canvas"></canvas>

    <!-- END HTML -->

    <script>

        var model_fits_id = "#hyphy-model-fits";
        var omega_plots_id = "#hyphy-omega-plots";
        var summary_id = "#hyphy-relax-summary";
        var tree_id = "#tree-tab";

        var tree_settings = {
            'omegaPlot': {},
            'tree-options': {
                /* value arrays have the following meaning
                    [0] - the value of the attribute
                    [1] - does the change in attribute value trigger tree re-layout?
                */
                'hyphy-tree-model': [null, true],
                'hyphy-tree-highlight': [null, false],
                'hyphy-tree-branch-lengths': [true, true],
                'hyphy-tree-fill-legend': [true, false],
                'hyphy-tree-fill-color': [true, false]
            },
            'suppress-tree-render': false,
            'chart-append-html' : true
        };

        $(document).ready(function() {
            d3.json("test-data/test.json", function(json) {
                render_summary(json, summary_id);
                render_omega_plots(json, omega_plots_id);
                //render_model_fits(json, model_fits_id);
                //render_tree(json, tree_id, tree_settings);
           });
        });


        $("#datamonkey-relax-load-json").on("change", function(e) {
            // FileList object
            var files = e.target.files; 

            if (files.length == 1) {
                var f = files[0];
                var reader = new FileReader();

                reader.onload = (function(theFile) {
                    return function(e) {
                        json = JSON.parse(e.target.result);
                        rerender_summary(json, summary_id);
                        rerender_omega_plots(json, omega_plots_id);
                        //rerender_model_fits(json, model_fits_id);
                        //rerender_tree(json, tree_id, tree_settings);
                    };

                })(f);

                reader.readAsText(f);
            }

            e.preventDefault();
        });

    </script>

</body>

</html>
